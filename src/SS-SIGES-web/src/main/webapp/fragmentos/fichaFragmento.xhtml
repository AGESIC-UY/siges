<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ace="http://www.icefaces.org/icefaces/components"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:icecore="http://www.icefaces.org/icefaces/core"
                xmlns:ice="http://www.icesoft.com/icefaces/component"
                xmlns:o="http://omnifaces.org/ui"
                xmlns:of="http://omnifaces.org/functions">

    <script type="text/javascript">
        // slight update to account for browsers not supporting e.which
        function disableF5(e) {
            if ((e.which || e.keyCode) == 116)
                e.preventDefault();
        }
        ;
        // To disable f5
        // jQuery menor a 1.7
        $(document).bind("keydown", disableF5);
        /* OR jQuery >= 1.7 */
        $(document).on("keydown", disableF5);
    </script>


    <o:form id="ficha" 
            useRequestURI="true"
            includeRequestParams="true"
            includeViewParams="true"
            rendered="#{!inicioMB.usuarioAdmin}">

        <f:metadata>
            <o:viewParam name="programaProyectoId" value="#{fichaMB.fichaTO.proyProgId}"
                         rendered="#{fichaMB.fichaTO != null and fichaMB.fichaTO.fichaFk != null}" />
        </f:metadata>

        <ace:textEntry style="display: none" id="diaHoraServer" value="#{fichaMB.diaHoraServer}"/>
        <!-- Titulo -->
        <ice:panelGroup id="tituloPagina" styleClass="tituloPagina">
            <ice:outputLabel value="#{labels.tituloFicha}"/>
            
            <h:link id="linkEditarFichaActual"
                    outcome="IR_A_EDITAR_FICHA" 
                    rendered="#{fichaMB.fichaTO.fichaFk != null}"
                    value="(#{fichaMB.fichaTO.fichaFk})"
                    title="#{labels.actualizar}">
                <o:param name="programaProyectoId" value="#{fichaMB.fichaTO.proyProgId}" />
            </h:link>

        </ice:panelGroup>

        <!-- Datos generales de la ficha -->
        <ice:panelGroup id="ficha_datos_generales" styleClass="fichaDatosGenerales" >

            <ice:panelGroup id="fichaIzq" styleClass="fondo-gris col-sm-8 recuadro formulario">
                <ice:panelGroup styleClass="col-sm-6">
                    <ice:selectOneRadio disabled="#{fichaMB.fieldDisabled('tipoFicha')}" 
                                        partialSubmit="true" 
                                        value="#{fichaMB.fichaTO.tipoFicha}" 
                                        styleClass="radioButton">
                        <f:selectItem itemValue="1" itemLabel="Programa" />
                        <f:selectItem itemValue="2" itemLabel="Proyecto" />
                    </ice:selectOneRadio >
                </ice:panelGroup>

                <ice:panelGroup styleClass="col-sm-6 no-padding fichaUltAct">
                    <ice:outputLabel value="#{labels.ficha_fechaActualizacion}:&nbsp;"
                                     rendered="#{fichaMB.obtenerFechaAct() != null}"/>
                    <ice:outputText value="#{fichaMB.obtenerFechaAct()}" 
                                    converter="fechaConverter"
                                    rendered="#{fichaMB.obtenerFechaAct() != null}"/>
                    <ice:commandButton style="background-color: #{fichaMB.fichaTO.fechaActColor};"
                                       styleClass="botonSemaforo" 
                                       disabled="true"
                                       rendered="#{fichaMB.fichaTO.fechaActColor != null}"/>
                </ice:panelGroup>

                <ice:panelGroup styleClass="col-sm-12 no-padding">
                    <ice:panelGroup styleClass="col-sm-2">
                        <ice:outputLabel value="#{labels.nombreProgProy}:" styleClass="obligatorio"/>
                    </ice:panelGroup>
                    <ice:panelGroup styleClass="col-sm-10">
                        <ace:textEntry disabled="#{fichaMB.fieldDisabled('Nombre')}"
                                       value="#{fichaMB.fichaTO.nombre}"
                                       style="width:100%;"/>
                    </ice:panelGroup>
                </ice:panelGroup>

                <ice:panelGroup styleClass="col-sm-12">
                    <ice:outputLabel value="#{labels.descFicha}:"/>

                    <ice:panelGroup rendered="#{fichaMB.fieldRendered('resumenEjecutivo', fichaMB.fichaTO.resumenEjecutivo) and fichaMB.downloadFile[fichaMB.fichaTO.resumenEjecutivo.docsPk] != null}"
                                    styleClass="linkFichaRight">
                        <c:set var="labelLinkResumenEjecutivo" value="#{labels.verResumenEjecutivoFicha} #{fichaMB.fichaTO.resumenEjecutivo != null and fichaMB.fichaTO.resumenEjecutivo.docsTipo != null and fichaMB.fichaTO.resumenEjecutivo.docsTipo.tipodocInstTipoDocFk != null ? fichaMB.fichaTO.resumenEjecutivo.docsTipo.tipodocInstTipoDocFk.tipodocNombre : ''}" />
                        <ice:outputResource 
                            rendered="#{fichaMB.downloadFile[fichaMB.fichaTO.resumenEjecutivo.docsPk] != null}"
                            resource="#{fichaMB.downloadFile[fichaMB.fichaTO.resumenEjecutivo.docsPk]}"
                            label="#{labelLinkResumenEjecutivo}"
                            fileName="#{fichaMB.downloadFile[fichaMB.fichaTO.resumenEjecutivo.docsPk] != null ? fichaMB.downloadFile[fichaMB.fichaTO.resumenEjecutivo.docsPk].docFile.docfileNombre : 'file'}"/>
                    </ice:panelGroup>

                    <ace:richTextEntry id="descripcion"
                                       value="#{fichaMB.fichaTO.descripcion}" 
                                       disabled="#{fichaMB.fieldDisabled('Descripcion')}"
                                       rendered="#{fichaMB.fieldRendered('Descripcion')}"
                                       toolbar="Basic" immediate="true" language="es"
                                       skin="kama" saveOnSubmit="true"
                                       styleClass="ancho100" height="80px" 
                                       converter="SanitizerAceRichTextConverter"/>

                    <ice:panelGroup styleClass="recuadro"
                                    rendered="#{!fichaMB.fieldRendered('Descripcion')}">
                        <ice:outputText rendered="#{!fichaMB.fieldRendered('Descripcion')}"
                                        value="#{fichaMB.fichaTO.descripcion}"
                                        escape="false"/>
                    </ice:panelGroup>
                </ice:panelGroup>

                <ice:panelGroup styleClass="col-sm-12">
                    <ice:outputLabel value="#{labels.objFicha}:"/>
                    <ace:richTextEntry id="objetivo"
                                       value="#{fichaMB.fichaTO.objetivo}" 
                                       disabled="#{fichaMB.fieldDisabled('Objetivo')}"
                                       rendered="#{fichaMB.fieldRendered('Objetivo')}"
                                       toolbar="Basic" immediate="true" language="es"
                                       skin="kama" saveOnSubmit="true"
                                       styleClass="ancho100" height="80px" 
                                       converter="SanitizerAceRichTextConverter"/>

                    <ice:panelGroup styleClass="recuadro"
                                    rendered="#{!fichaMB.fieldRendered('Objetivo')}">
                        <ice:outputText rendered="#{!fichaMB.fieldRendered('Objetivo')}"
                                        value="#{fichaMB.fichaTO.objetivo}"
                                        escape="false"/>
                    </ice:panelGroup>
                </ice:panelGroup>

                <ice:panelGroup styleClass="col-sm-12">
                    <ice:outputLabel value="#{labels.objPublicoFicha}:"/>
                    <ace:richTextEntry id="objPublico"
                                       value="#{fichaMB.fichaTO.objPublico}" 
                                       disabled="#{fichaMB.fieldDisabled('PubObjetivo')}"
                                       rendered="#{fichaMB.fieldRendered('PubObjetivo')}"
                                       toolbar="Basic" immediate="true" language="es"
                                       skin="kama" saveOnSubmit="true" 
                                       styleClass="ancho100" height="80px"
                                       converter="SanitizerAceRichTextConverter"/>
                    <ice:panelGroup styleClass="recuadro"
                                    rendered="#{!fichaMB.fieldRendered('PubObjetivo')}">
                        <ice:outputText rendered="#{!fichaMB.fieldRendered('PubObjetivo')}"
                                        value="#{fichaMB.fichaTO.objPublico}"
                                        escape="false"/>
                    </ice:panelGroup>
                </ice:panelGroup>

                <ice:panelGroup styleClass="col-sm-12">
                    <ice:outputLabel value="#{labels.factorImpacto}:"/>
                    <ace:richTextEntry id="factorImpacto"
                                       value="#{fichaMB.fichaTO.factorImpacto}" 
                                       disabled="#{fichaMB.fieldDisabled('FactorImpacto')}"
                                       rendered="#{fichaMB.fieldRendered('FactorImpacto')}"
                                       toolbar="Basic" immediate="true" language="es"
                                       skin="kama" saveOnSubmit="true" 
                                       styleClass="ancho100" height="80px"
                                       converter="SanitizerAceRichTextConverter"/>
                    <ice:panelGroup styleClass="recuadro"
                                    rendered="#{!fichaMB.fieldRendered('FactorImpacto')}">
                        <ice:outputText rendered="#{!fichaMB.fieldRendered('FactorImpacto')}"
                                        value="#{fichaMB.fichaTO.factorImpacto}"
                                        escape="false"/>
                    </ice:panelGroup>
                </ice:panelGroup>

                <ice:panelGroup id="panelSituacionActual" styleClass="col-sm-12"
                                rendered="#{fichaMB.fichaTO.proyecto}">
                    <ice:panelGroup>
                        <ice:outputLabel value="#{labels.ficha_situacionActualFicha}&nbsp;"/>
                        <ice:outputLabel rendered="#{not fichaMB.actualizandoSituacionActual}" value="#{fichaMB.fechaUltimaSitAct}"/>
                        <ice:outputLabel rendered="#{fichaMB.actualizandoSituacionActual}" value="#{fichaMB.obtenerFechaAct()}"  converter="fechaConverter" />
                        <ice:outputLabel value=":&nbsp;"/>

                        <ice:commandLink action="#{fichaMB.actualizarSituacionActual()}" 
                                         value="#{labels.ficha_actualizar_situacion_actual}" 
                                         title="#{labels.ficha_actualizar_situacion_actual_descripcion}"
                                         rendered="#{fichaMB.fieldRendered('ActualizarSitActual')}"/>

                        <ice:commandLink action="#{fichaMB.cancelarActualizacionSituacionActual()}" 
                                         value="#{labels.ficha_cancelar_actualizacion_situacion_actual}" 
                                         title="#{labels.ficha_cancelar_actualizacion_actual_descripcion}"
                                         rendered="#{fichaMB.fieldRendered('CancelarActualizacionSitActual')}"/>

                        <ice:commandLink action="#{fichaMB.verHistoricoSitActAction()}" 
                                         value="#{labels.ficha_historico_sitact}" 
                                         title="#{labels.ficha_historico_sitact}"
                                         styleClass="linkFichaRight"/>
                    </ice:panelGroup>
                    
                    <ice:panelGroup>
                        <ace:richTextEntry id="situacionActual"
                                           value="#{fichaMB.situacionActual}" 
                                           disabled="#{fichaMB.fieldDisabled('SitActual')}"
                                           rendered="#{fichaMB.fieldRendered('SitActual')}"
                                           toolbar="Basic" immediate="true" language="es" 
                                           skin="kama" saveOnSubmit="true" 
                                           styleClass="ancho100" height="100px" 
                                           converter="SanitizerAceRichTextConverter"/>

                        <ice:panelGroup styleClass="recuadro"
                                        rendered="#{!fichaMB.fieldRendered('SitActual')}">
                            <ice:outputText rendered="#{!fichaMB.fieldRendered('SitActual')}"
                                            value="#{fichaMB.fichaTO.situacionActual}"
                                            escape="false"/>
                        </ice:panelGroup>
                    </ice:panelGroup>
                </ice:panelGroup>

                <ice:commandLink action="#{fichaMB.linkToGRP()}" 
                                 value="#{labels.ficha_grp_link}"
                                 title="#{labels.ficha_grp_link}"
                                 rendered="#{not empty fichaMB.fichaTO.grp}"/>


                <ice:panelGroup styleClass="col-sm-12 no-padding">
                    <ice:panelGroup rendered="#{fichaMB.fichaTO.proyecto}" styleClass="panelEstadoProducto">
                        <ice:panelGroup styleClass="form-group">
                            <ice:outputLabel value="#{labels.ficha_publicar_visualizador}:"/>
                            <ace:checkboxButton value="#{fichaMB.fichaTO.publicable}"
                                                disabled="#{fichaMB.fieldDisabled('fichaPublicable')}"/>
                            <ice:panelGroup rendered="#{fichaMB.fichaTO.publicable and fichaMB.estadoPublicacionPendientesStr() != null}" styleClass="pendientesFicha">
                                <ice:outputText value="#{fichaMB.estadoPublicacionPendientesStr()}" />
                            </ice:panelGroup>
                        </ice:panelGroup>

                        <ice:panelGroup styleClass="form-group">
                            <ice:outputLabel value="#{labels.ficha_estado_producto}:"
                                             styleClass="col-sm-3"/>
                            <ice:panelGroup styleClass="col-sm-3">
                                <ice:selectOneMenu id="comboEstadoProd" value="#{fichaMB.listaEtapaPubCombo.selected}"
                                                   disabled="#{fichaMB.fieldDisabled('EtapaPublicacion', fichaMB.fichaTO.publicable)}"
                                                   styleClass="textoMedio">
                                    <f:selectItems value="#{fichaMB.listaEtapaPubCombo.items}"/>
                                </ice:selectOneMenu>
                            </ice:panelGroup>

                            <ice:outputLabel value="#{labels.ficha_estado_publicacion}:"
                                             styleClass="col-sm-3"/>
                            <ice:outputText value="#{fichaMB.estadoPublicacionStr()}"
                                            styleClass="col-sm-4" />
                        </ice:panelGroup>

                    </ice:panelGroup>

                    <ice:panelGroup style="clear: both" id="estadoFicha">
                        <img class="img-responsive fases" src="./../img/#{fichaMB.imgEstado}"/>
                        <ice:outputText value="#{fichaMB.solCambioEstadoStr()}" />
                    </ice:panelGroup>

                    <ice:panelGroup styleClass="panelAcciones">
                        <ice:panelGroup styleClass="centrado panelBotones margen-sup">
                            <ace:pushButton rendered="#{fichaMB.fieldRendered('retrocederEstadoFicha') and fichaMB.labelBtnEstAnterior != ''}"
                                            disabled="#{fichaMB.fieldDisabled('retrocederEstadoFicha') and fichaMB.labelBtnEstAnterior != ''}"
                                            style="margin-left: 10px;"
                                            value="#{fichaMB.labelBtnEstAnterior}" 
                                            action="#{fichaMB.retrocederEstadoFichaAction()}" 
                                            styleClass="boton principal atras"/>

                            <ace:pushButton rendered="#{fichaMB.fieldRendered('AprobarFicha') and fichaMB.labelBtnAprobar != ''}" 
                                            disabled="#{fichaMB.fieldDisabled('AprobarFicha') and fichaMB.labelBtnAprobar != ''}" 
                                            style="margin-left: 10px;"
                                            value="#{fichaMB.labelBtnAprobar}" 
                                            action="#{fichaMB.guardarAprobarFichaAction()}" 
                                            styleClass="boton principal adelante"/>

                            <!-- aca iba el popup confirmacion eliminar --> 
                        </ice:panelGroup>
                    </ice:panelGroup>
                </ice:panelGroup>

            </ice:panelGroup>

            <ice:panelGroup id="fichaDer" styleClass="col-sm-4 no-padding">
                <ice:panelGroup id="fichaProgProyPMO1_Parte1" styleClass="formulario recuadro">
                    <ice:panelGroup rendered="#{fichaMB.fieldRendered('Area')}">
                        <ice:outputLabel value="#{labels.areaOrganizacionFicha}:"
                                         styleClass="col-sm-3 obligatorio"/>
                        <ice:selectOneMenu id="comboAreas" value="#{fichaMB.listaAreasOrganismoCombo.selected}"
                                           disabled="#{fichaMB.fieldDisabled('Area')}"
                                           styleClass="col-sm-9">
                            <f:selectItems value="#{fichaMB.listaAreasOrganismoCombo.items}"/>
                        </ice:selectOneMenu>
                    </ice:panelGroup>
                   
                    <ice:panelGroup rendered="#{fichaMB.fieldRendered('ObjetivoEstrategico')}">
                        <ice:outputLabel value="#{fichaMB.labelObjEstValue}:" 
                                         styleClass="col-sm-3"/>
                        <ice:selectOneMenu id="comboObjetivosEstrategicos" value="#{fichaMB.listaObjetivosEstrategicosCombo.selected}"
                                           disabled="#{fichaMB.fieldDisabled('ObjetivoEstrategico')}"
                                           styleClass="col-sm-9">
                            <f:selectItems value="#{fichaMB.listaObjetivosEstrategicosCombo.items}"/>
                        </ice:selectOneMenu>
                    </ice:panelGroup>
                    
                    <ice:panelGroup rendered="#{fichaMB.fieldRendered('Programas')}">
                        <ice:panelGroup styleClass="col-sm-9">
                            <ice:outputLabel value="#{labels.programaFicha}:"
                                             styleClass="col-sm-4"/>
                            <ice:selectOneMenu id="comboProgramas" 
                                               value="#{fichaMB.listaProgramasCombo.selected}" 
                                               disabled="#{fichaMB.fieldDisabled('Programas')}" 
                                               valueChangeListener="#{fichaMB.progSetPeso}"
                                               partialSubmit="true"
                                               styleClass="col-sm-8">
                                <f:selectItems value="#{fichaMB.listaProgramasCombo.items}" />
                            </ice:selectOneMenu>
                        </ice:panelGroup>

                        <ice:panelGroup styleClass="col-sm-3 peso">
                            <ice:outputLabel value="#{labels.pesoFicha}"
                                             styleClass="col-sm-4"/>
                            <ace:textEntry value="#{fichaMB.fichaTO.peso}" 
                                           styleClass="col-sm-4" 
                                           disabled="#{fichaMB.fieldDisabled('Peso')}"
                                           rendered="#{fichaMB.fieldRendered('Peso')}"
                                           converter="IntegerFormatConverter" 
                                           converterMessage="#{labels.error_ingreso_incorrecto}"/>
                        </ice:panelGroup>
                    </ice:panelGroup>

                    <ice:panelGroup rendered="#{fichaMB.fieldRendered('Gerente')}">
                        <ice:outputLabel value="#{labels.gerenteFicha}:"
                                         styleClass="col-sm-3 obligatorio"/>
                        <ice:selectOneMenu id="comboGerente" value="#{fichaMB.listaGerenteCombo.selected}"
                                           disabled="#{fichaMB.fieldDisabled('Gerente')}" 
                                           styleClass="col-sm-9">
                            <f:selectItems value="#{fichaMB.listaGerenteCombo.items}"/>
                        </ice:selectOneMenu>
                    </ice:panelGroup>

                    <ice:panelGroup rendered="#{fichaMB.fieldRendered('Adjunto')}">
                        <ice:outputLabel value="#{labels.adjuntoFicha}:"
                                         styleClass="col-sm-3 obligatorio" />
                        <ice:selectOneMenu id="comboAdjunto" value="#{fichaMB.listaAdjuntoCombo.selected}"
                                           disabled="#{fichaMB.fieldDisabled('Adjunto')}"
                                           styleClass="col-sm-9">
                            <f:selectItems value="#{fichaMB.listaAdjuntoCombo.items}"/>
                        </ice:selectOneMenu>
                    </ice:panelGroup>

                    <ice:panelGroup rendered="#{fichaMB.fieldRendered('Sponsor')}">
                        <ice:outputLabel value="#{labels.sponsorFicha}:"
                                         styleClass="col-sm-3 obligatorio" />
                        <ice:selectOneMenu id="comboSponsor" value="#{fichaMB.listaSponsorCombo.selected}"
                                           disabled="#{fichaMB.fieldDisabled('Sponsor')}"
                                           styleClass="col-sm-9">
                            <f:selectItems value="#{fichaMB.listaSponsorCombo.items}"/>
                        </ice:selectOneMenu>
                    </ice:panelGroup>

                    <ice:panelGroup rendered="#{fichaMB.fieldRendered('PMOFederada')}">
                        <ice:outputLabel value="#{labels.pmoFederadaFicha}:"
                                         styleClass="col-sm-3 obligatorio"/>
                        <ice:selectOneMenu id="comboPMOFed" value="#{fichaMB.listaPmoFederadaCombo.selected}"
                                           disabled="#{fichaMB.fieldDisabled('PMOFederada')}"
                                           styleClass="col-sm-9">
                            <f:selectItems value="#{fichaMB.listaPmoFederadaCombo.items}"/>
                        </ice:selectOneMenu>
                    </ice:panelGroup>

                    <!-- #{labels.fichaConfiguracion}  -->
                    <ice:panelGroup styleClass="semaforo">
                        <ice:panelGroup styleClass="col-sm-4">
                            <ice:outputLabel value="#{labels.tiempoSemaforoAmarillo}:"/>  
                            <ace:textEntry value="#{fichaMB.fichaTO.semaforoAmarillo}" 
                                           disabled="#{fichaMB.fieldDisabled('SemaforoAmarillo')}"
                                           style="float:left" styleClass="textoCorto"
                                           converter="IntegerFormatConverter"/>
                        </ice:panelGroup>

                        <ice:panelGroup styleClass="col-sm-4">
                            <ice:outputLabel value="#{labels.tiempoSemaforoRojo}:"/>
                            <ace:textEntry value="#{fichaMB.fichaTO.semaforoRojo}" 
                                           disabled="#{fichaMB.fieldDisabled('SemaforoRojo')}"
                                           style="float:left" styleClass="textoCorto"
                                           converter="IntegerFormatConverter"/>
                        </ice:panelGroup>

                        <!--
                        <ice:panelGroup styleClass="col-sm-4">
                            <ice:outputLabel value="# {labels.grpFicha}"/>
                            <ace:textEntry value="# {fichaMB.fichaTO.grp}" 
                                           disabled="# {fichaMB.fieldDisabled('GRP')}" 
                                           style="float:left" styleClass="textoCorto"/>
                        </ice:panelGroup>
                        -->
                        <ice:panelGroup styleClass="col-sm-4">
                            <ice:commandLink value="#{labels.ficha_copiar_proy}" 
                                             action="#{fichaMB.verCopiaProyAction()}"
                                             rendered="#{fichaMB.fieldRendered('copiarProyecto')}" style="font-size: 0.9em; display: block; margin-top: 14px;"/>
                            <ice:commandLink value="#{labels.ficha_copiar_prog}" 
                                             action="#{fichaMB.verCopiaProgAction()}"
                                             rendered="#{fichaMB.fieldRendered('copiarPrograma')}" style="font-size: 0.9em; display: block; margin-top: 14px;"/>
                            <ice:commandLink value="#{labels.ficha_mover_proy}"
                                             action="#{moverProyectoMB.verMoverProyAction()}"
                                             rendered="#{fichaMB.fieldRendered('moverProyecto')}" style="font-size: 0.9em; display: block;"/>
                        </ice:panelGroup>
                    </ice:panelGroup>

                    <ice:panelGroup style="clear: both">
                        <ice:panelGroup styleClass="col-sm-3 colCenter"
                                        rendered="#{fichaMB.fieldRendered('AreaTematica')}">
                            <ice:outputLabel value="#{labels.areaTematicaFicha}"/>
                            <ace:pushButton styleClass="botonEditar iconoTabla #{fichaMB.areasTematicasHasValues() ? 'valores' : ''}" 
                                            action="#{fichaMB.areaTematicaPopup}"/>
                        </ice:panelGroup>

                        <ice:panelGroup styleClass="col-sm-3 colCenter"
                                        rendered="#{fichaMB.fieldRendered('PermisosLectura')}">
                            <ice:outputLabel value="#{labels.permisosLectura}"/>
                            <ace:pushButton styleClass="botonEditar iconoTabla #{fichaMB.areasRestringidasHasValues() ? 'valores' : ''}" 
                                            action="#{fichaMB.lecturaPopup}"/>
                        </ice:panelGroup>

                        <ice:panelGroup styleClass="col-sm-3 colCenter"
                                        rendered="#{fichaMB.fieldRendered('Metodologia')}">
                            <ice:outputLabel value="#{labels.metodologia}"/>
                            <ace:pushButton   styleClass="botonEditar iconoTabla #{fichaMB.metodologíasHasValues() ? 'valores' : ''}" 
                                             action="#{fichaMB.metodologiaPopup}"/>
                        </ice:panelGroup>

                        <ice:panelGroup styleClass="col-sm-3 colCenter"
                                        rendered="#{fichaMB.fieldRendered('notificaciones')}">
                            <ice:outputLabel value="#{labels.ficha_notificaciones}"/>
                            <ace:pushButton  styleClass="botonEditar iconoTabla #{fichaMB.notificacionesHasValues() ? 'valores' : ''}" 
                                             action="#{fichaMB.notificacionPopupAction()}"/>
                        </ice:panelGroup>
                    </ice:panelGroup>

                    <ice:panelGroup rendered="#{fichaMB.fieldRendered('FichaPresupuesto') and fichaMB.fichaTO.proyecto}">
                        <ice:outputLabel value="#{labels.ficha_presupuesto_aprob}:"
                                         styleClass="col-sm-12"/>
                        <ice:selectOneMenu value="#{fichaMB.listaMonedaPreCombo.selected}"
                                           styleClass="col-sm-3"
                                           style="margin-right:10px"
                                           disabled="#{fichaMB.fieldDisabled('FichaPresupuesto')}">
                            <f:selectItems value="#{fichaMB.listaMonedaPreCombo.items}"/>
                        </ice:selectOneMenu>

                        <ace:textEntry value="#{fichaMB.preFicha.preBase}"
                                       styleClass="col-sm-4 textoCorto alinearDerecha"
                                       style="margin-right:10px; padding-right:10px;"
                                       disabled="#{fichaMB.fieldDisabled('FichaPresupuesto')}"
                                       converter="ImporteFormatConverter" />

                        <ice:selectOneMenu value="#{fichaMB.listaFuentesPreCombo.selected}"
                                           styleClass="col-sm-5"
                                           disabled="#{fichaMB.fieldDisabled('FichaPresupuesto')}">
                            <f:selectItems value="#{fichaMB.listaFuentesPreCombo.items}"/>
                        </ice:selectOneMenu>
                    </ice:panelGroup>
                </ice:panelGroup>
                <!-- desde -->
                <ice:panelGroup id="fichaDerAreasInfo" 
                                rendered="#{fichaMB.fichaTO.proyecto}"
                                styleClass="formulario margen-sup fondo-gris panelOtrosDatos">
                    <ice:outputLabel value="#{labels.ficha_areas_titulo}"
                                     styleClass="centrarDato subtitulo"/>

                    <ul style="">
                        <ui:repeat var="selection" value="#{fichaMB.areasTematicasSelected}">
                            <li>
                                <h:outputText value="#{selection.userObject.areatagNombre}" />
                                <h:outputText value="(#{selection.userObject.areatagPadresStr})"
                                              rendered="#{selection.userObject.areatagPadresStr != null}"/>
                            </li>
                        </ui:repeat>
                    </ul>
                </ice:panelGroup>
                <!-- hasta -->


                <ice:panelGroup id="fichaDerOtros" 
                                rendered="#{fichaMB.fichaTO.proyecto}"
                                styleClass="formulario margen-sup fondo-gris panelOtrosDatos">
                    <ice:outputLabel value="#{labels.ficha_otros_datos_titulo}"
                                     styleClass="centrarDato subtitulo"/>

                    <ice:panelGroup >
                        <ice:outputLabel value="#{labels.ficha_otros_datos_cat_principal}:"
                                         styleClass="col-sm-5"/>
                        <ice:outputText value="#{fichaMB.fichaTO.otrosDatos.proyOtrCatFk.catProyNombre}"/>
                    </ice:panelGroup>

                    <ice:panelGroup >
                        <ice:outputLabel value="#{labels.ficha_otros_datos_cat_secundarias}:"
                                         styleClass="col-sm-5"/>
                        <ice:outputText value="#{fichaMB.otrosDatCatSecundariaStr()}"/>
                    </ice:panelGroup>

                    <ice:panelGroup styleClass="margen-sup">
                        <ice:outputLabel value="#{labels.ficha_otros_datos_inst_ejec}:"
                                         styleClass="col-sm-5"/>
                        <ice:outputText value="#{fichaMB.fichaTO.otrosDatos.proyOtrInsEjeFk.orgaNombre}"/>
                    </ice:panelGroup>

                    <ice:panelGroup >
                        <ice:outputLabel value="#{labels.ficha_otros_datos_origen}:"
                                         styleClass="col-sm-5"/>
                        <ice:outputText value="#{fichaMB.fichaTO.otrosDatos.proyOtrOrigen}"/>
                    </ice:panelGroup>

                    <ice:panelGroup >
                        <ice:outputLabel value="#{labels.ficha_otros_datos_contratista}:"
                                         styleClass="col-sm-5"/>
                        <ice:outputText value="#{fichaMB.fichaTO.otrosDatos.proyOtrContFk.orgaNombre}"/>
                    </ice:panelGroup>

                    <ice:panelGroup styleClass="margen-sup">
                        <ice:outputLabel value="#{labels.ficha_otros_datos_obs}:"
                                         styleClass="col-sm-5"/>
                        <ice:outputText value="#{fichaMB.fichaTO.otrosDatos.proyOtrObservaciones}"/>
                    </ice:panelGroup>                    

                    <ice:panelGroup styleClass="margen-sup">
                        <ice:outputLabel value="#{labels.ficha_otros_datos_inicio}:"
                                         styleClass="col-sm-5"/>
                        <ice:outputText value="#{fichaMB.fichaTO.otrosDatos.proyOtrEntFk.entNombre}"/>
                    </ice:panelGroup>

                    <ice:panelGroup >
                        <ice:outputLabel value="#{labels.ficha_otros_datos_duracion}:"
                                         styleClass="col-sm-5"/>
                        <ice:outputText value="#{fichaMB.fichaTO.otrosDatos.proyOtrPlazo}"
                                        converter="ImporteFormatConverter"/>
                    </ice:panelGroup>

                    <ice:panelGroup>
                        <c:set var="porc" value="%"/>
                        <ice:outputLabel value="#{labels.ficha_otros_datos_avance_prod}:"
                                         styleClass="col-sm-5"/>
                        <ice:panelGroup id="indiceAvanceProd" styleClass="indice3color">
                            <ice:panelGroup style="width:#{moduloCronogramaMB.indiceAvanceProd[0]}#{porc}"
                                            styleClass="indice3colorBlue">
                                <ice:outputText value="#{moduloCronogramaMB.indiceAvanceProd[0]}%" rendered="#{moduloCronogramaMB.indiceAvanceProd[0] gt 10}" />
                            </ice:panelGroup>
                            <ice:panelGroup style="width:#{moduloCronogramaMB.indiceAvanceProd[1]}#{porc}"
                                            styleClass="indice3colorGreen">
                                <ice:outputText value="#{moduloCronogramaMB.indiceAvanceProd[1]}%" rendered="#{moduloCronogramaMB.indiceAvanceProd[1] gt 10}" />
                            </ice:panelGroup>
                            <ice:panelGroup style="width:#{moduloCronogramaMB.indiceAvanceProd[2]}#{porc}"
                                            styleClass="indice3colorRed">
                                <ice:outputText value="#{moduloCronogramaMB.indiceAvanceProd[2]}%" rendered="#{moduloCronogramaMB.indiceAvanceProd[2] gt 10}" />
                            </ice:panelGroup>
                        </ice:panelGroup>
                    </ice:panelGroup>

                    <ice:panelGroup>
                        <ice:outputLabel value="#{labels.ficha_otros_datos_avance_tiempo}:"
                                         styleClass="col-sm-5"/>
                        <ice:panelGroup id="indiceAvanceTiempo" styleClass="indice3color">
                            <ice:panelGroup style="width:#{moduloCronogramaMB.indiceAvanceTiempo[0]}#{porc}"
                                            styleClass="indice3colorBlue">
                                <ice:outputText value="#{moduloCronogramaMB.indiceAvanceTiempo[0]}%" rendered="#{moduloCronogramaMB.indiceAvanceTiempo[0] gt 10}" />
                            </ice:panelGroup>
                            <ice:panelGroup style="width:#{moduloCronogramaMB.indiceAvanceTiempo[1]}#{porc}"
                                            styleClass="indice3colorGreen">
                                <ice:outputText value="#{moduloCronogramaMB.indiceAvanceTiempo[1]}%" rendered="#{moduloCronogramaMB.indiceAvanceTiempo[1] gt 10}" />
                            </ice:panelGroup>
                            <ice:panelGroup style="width:#{moduloCronogramaMB.indiceAvanceTiempo[2]}#{porc}"
                                            styleClass="indice3colorRed">
                                <ice:outputText value="#{moduloCronogramaMB.indiceAvanceTiempo[2]}%" rendered="#{moduloCronogramaMB.indiceAvanceTiempo[2] gt 10}" />
                            </ice:panelGroup>
                        </ice:panelGroup>
                    </ice:panelGroup>

                    <ace:pushButton action="#{fichaMB.otrosDatosPopupAction()}"
                                    styleClass="botonEditar boton iconoTabla"/>
                </ice:panelGroup>

                <ice:panelGroup id="fichaDerLinks" styleClass="margen-sup linksReportes fondo-gris" 
                                rendered="#{fichaMB.fieldRendered('linksReportes')}">
                    <ice:outputLabel value="#{labels.tituloFichaReportes}"
                                     styleClass="centrarDato subtitulo"/>

                    <ice:panelGroup rendered="#{fichaMB.fichaTO.programa}">
                        <ice:commandLink id="linkReportePrograma"
                                         action="#{inicioMB.irReportePrograma(fichaMB.fichaTO.fichaFk, true)}" 
                                         rendered="#{fichaMB.fichaTO.programa}"
                                         title="#{labels.inicio_reporte_prog}">
                            <ice:outputLabel value="#{labels.ficha_link_prog}" />
                            <ice:graphicImage value="../img/reporte-v.png" />
                        </ice:commandLink>
                    </ice:panelGroup>

                    <ice:panelGroup rendered="#{fichaMB.fichaTO.proyecto}">
                        <ice:commandLink id="linkReporteProyecto"
                                         action="#{inicioMB.irReporteProyecto(fichaMB.fichaTO.fichaFk, true)}" 
                                         rendered="#{fichaMB.fichaTO.proyecto}"
                                         title="#{labels.inicio_reporte_proy}">
                            <ice:outputLabel value="#{labels.ficha_link_proy}" />
                            <ice:graphicImage value="../img/reporte-v.png" />
                        </ice:commandLink>
                    </ice:panelGroup>

                    <ice:panelGroup rendered="#{fichaMB.fichaTO.proyecto}">
                        <ice:commandLink id="linkReporteProyectoTablas"
                                         action="#{inicioMB.irReporteProyectoTablas(fichaMB.fichaTO.fichaFk, true)}" 
                                         rendered="#{fichaMB.fichaTO.proyecto}"
                                         title="#{labels.inicio_reporte_cro_pre}">
                            <ice:outputLabel value="#{labels.ficha_link_cro_pre}" />
                            <ice:graphicImage value="../img/reporte-h.png" />
                        </ice:commandLink>
                    </ice:panelGroup>

                    <ice:panelGroup rendered="#{fichaMB.fichaTO.proyecto}">
                        <ice:commandLink action="#{inicioMB.irReporteCronograma(fichaMB.fichaTO.fichaFk, true)}" 
                                         rendered="#{fichaMB.fichaTO.proyecto}"
                                         title="#{labels.cro_hist_lineabase_link}">
                            <ice:outputLabel value="#{labels.cro_hist_lineabase_link}" />
                            <ice:graphicImage value="../img/reporte-v.png" />
                        </ice:commandLink>
                    </ice:panelGroup>
                </ice:panelGroup>
                
                <ice:panelGroup id="fichaDerReplanificacion" styleClass="margen-sup linksReportes fondo-gris" 
                                rendered="#{fichaMB.fieldRendered('panelReplanificacion')}">
                    <ice:outputLabel value="#{labels.replan_titulo_popup}"
                                     styleClass="centrarDato subtitulo"/>
                    <ice:panelGrid columns="2">
                        <ice:outputLabel value="#{labels.replan_generar_nueva_linea_base}:"/>
                        <ice:outputText value="#{fichaMB.ultimaReplan.proyreplanGenerarLineaBase}"
                                         converter="sinoConverter"/>
                    
                        <ice:outputLabel value="#{labels.replan_no_permit_editar}:"/>
                        <ice:outputText value="#{fichaMB.ultimaReplan.proyreplanPermitEditar}"
                                         converter="sinoConverter"/>
                        
                        <ice:outputLabel value="#{labels.replan_generar_nuevo_presupuesto}:"/>
                        <ice:outputText value="#{fichaMB.ultimaReplan.proyreplanGenerarPresupuesto}"
                                         converter="sinoConverter"/>
                    
                        <ice:outputLabel value="#{labels.replan_desc_popup}:"/>
                        
                    </ice:panelGrid>
                    <ice:panelGroup styleClass="recuadro">
                            <ice:outputText value="#{fichaMB.ultimaReplan.proyreplanDesc}"/>
                    </ice:panelGroup>
                </ice:panelGroup>
            </ice:panelGroup>
        </ice:panelGroup>

        <ace:confirmationDialog id="confirmDialogAprobar"
                                widgetVar="confirmationEliminar"
                                message="#{labels.confirmacionEliminacion}"
                                header="#{labels.hConfirmacion}"
                                closable="true"
                                closeOnEscape="true"
                                severity="info"
                                modal="true"
                                position="center">
            <h:panelGrid columns="2" styleClass="centeredPanelGrid">
                <h:commandButton id="yesAprobar"
                                 value="#{labels.si}"
                                 styleClass="boton principal botonContinuar"
                                 onclick="confirmationEliminar.hide()" 
                                 actionListener="#{fichaMB.eliminarFichaAction()}"/>
                <h:commandButton id="noAprobar"
                                 value="#{labels.no}"
                                 styleClass="boton principal botonEliminar"
                                 onclick="confirmationEliminar.hide()"  />
            </h:panelGrid>
        </ace:confirmationDialog>

        <ice:panelGroup styleClass="panelAcciones">

            <!-- Panel de acciones de la ficha -->
            <ice:panelGroup rendered="#{fichaMB.selectedMostrar == null}" id="panelAcciones" 
                            styleClass="centrado panelBotones margen-sup">

                <ace:messages id="fichaMsg"/>

                <ace:pushButton rendered="#{fichaMB.fieldRendered('GuardarFicha')}"
                                disabled="#{fichaMB.fieldDisabled('GuardarFicha')}"
                                value="#{labels.guardarFicha}"
                                action="#{fichaMB.guardarFichaAction()}"
                                styleClass="boton principal guardar"/>

                <!--
                <ace:pushButton rendered="# {fichaMB.fieldRendered('retrocederEstadoFicha')}" 
                                style="margin-left: 10px;"
                                value="# {fichaMB.labelBtnEstAnterior}" 
                                action="# {fichaMB.retrocederEstadoFichaAction()}" 
                                styleClass="boton principal atras"/>

                <ace:pushButton rendered="# {fichaMB.fieldRendered('AprobarFicha')}" 
                                style="margin-left: 10px;"
                                value="# {fichaMB.labelBtnAprobar}" 
                                action="# {fichaMB.guardarAprobarFichaAction()}" 
                                styleClass="boton principal adelante"/>
                -->

                <h:commandButton id="btnEliminarFicha"
                                 value="#{labels.eliminar}" 
                                 rendered="#{fichaMB.fieldRendered('EliminarFicha')}"
                                 onclick="confirmationEliminar.show()" 
                                 style="margin-left: 10px;"
                                 styleClass="boton principal botonEliminar"
                                 type="button"/>

                <ace:linkButton value="#{labels.volver_inicio}" action="#{fichaMB.cancelar()}"/>
            </ice:panelGroup>
        </ice:panelGroup>

        <!-- Otros elementos de la ficha -->
        <ice:panelGroup id="panelOtrosDatos" styleClass="otrosDatos margen-sup">
            <div id="fichas">
                <ice:panelGroup id="fichaFragGrupo" 
                                styleClass="fichaFragGrupo no-padding row #{fichaMB.frameMax ? 'fichaFrameMax' : ''}">
                    <!-- El panel del Gannt ID = 3 -->
                    <ice:panelGroup styleClass="col-sm-3" 
                                    style="#{fichaMB.selectedMostrar == 3 ? 'width: 100%; padding-right:25px' : ''}" >
                        <ui:include src="./../fragmentos/fichaFragmentosGantt.xhtml"  />
                    </ice:panelGroup>

                    <!-- El panel del Presupuesto ID = 4 -->
                    <ice:panelGroup rendered="#{fichaMB.mostrarModulo('Presupuesto')}" styleClass="col-sm-3" 
                                    style="#{fichaMB.selectedMostrar == 4 ? 'width: 100%; padding-right:25px' : ''}">
                        <ui:include src="./../fragmentos/fichaFragmentosPresupuesto.xhtml"/>
                    </ice:panelGroup>

                    <!-- El panel de Productos ID  = 5 -->
                    <ice:panelGroup rendered="#{fichaMB.mostrarModulo('Productos')}" styleClass="col-sm-3"
                                    style="#{fichaMB.selectedMostrar == 5 ? 'width: 100%; padding-right:25px' : ''}">
                        <ui:include src="./../fragmentos/fichaFragmentosProductos.xhtml"/>
                    </ice:panelGroup>

                    <!-- EL PANEL DE INTERESADOS ID = 1 -->
                    <ice:panelGroup rendered="#{fichaMB.mostrarModulo('Interesados')}" styleClass="col-sm-3"
                                    style="#{fichaMB.selectedMostrar == 1 ? 'width: 100%; padding-right:25px' : ''}" >
                        <ui:include src="./../fragmentos/fichaFragmentosInteresados.xhtml"/>
                    </ice:panelGroup>

                    <!-- El panel de Riesgos ID = 2 -->
                    <ice:panelGroup rendered="#{fichaMB.mostrarModulo('Riesgos')}" styleClass="col-sm-3"
                                    style="#{fichaMB.selectedMostrar == 2 ? 'width: 100%; padding-right:25px' : ''}" >
                        <ui:include src="./../fragmentos/fichaFragmentosRiesgos.xhtml"/>
                    </ice:panelGroup>

                    <!-- El panel de Documentos ID  = 0 -->
                    <ice:panelGroup rendered="#{fichaMB.mostrarModulo('Documentos')}" styleClass="col-sm-3"
                                    style="#{fichaMB.selectedMostrar == 0 ? 'width: 100%; padding-right:25px' : ''}" >
                        <ui:include src="./../fragmentos/fichaFragmentosDocumentos.xhtml"/>
                    </ice:panelGroup>

                    <!-- EL PANEL DE INTERESADOS ID = 6 -->
                    <ice:panelGroup rendered="#{fichaMB.mostrarModulo('Colaboradores')}" styleClass="col-sm-3"
                                    style="#{fichaMB.selectedMostrar == 6 ? 'width: 100%; padding-right:25px;' : ''}" >
                        <ui:include src="./../fragmentos/fichaFragmentosParticipantes.xhtml"/>
                    </ice:panelGroup>

                    <!-- EL PANEL DE CALIDAD ID = 7 -->
                    <ice:panelGroup rendered="#{fichaMB.mostrarModulo('Calidad')}" styleClass="col-sm-3"
                                    style="#{fichaMB.selectedMostrar == 7 ? 'width: 100%; padding-right:25px' : ''}">
                        <ui:include src="./../fragmentos/fichaFragmentosCalidad.xhtml"/>
                    </ice:panelGroup>


                    <!-- PANEL MULTIMEDIA ID = 8 -->
                    <ice:panelGroup rendered="#{fichaMB.mostrarModulo('Multimedia')}" styleClass="col-sm-3"
                                    style="#{fichaMB.selectedMostrar == 8 ? 'width: 100%; padding-right:25px' : ''}" >
                        <ui:include src="./../fragmentos/fichaFragmentosMultimedia.xhtml"/>
                    </ice:panelGroup>

                    <!-- PANEL LOCALIZACIONES ID = 9 -->
                    <ice:panelGroup rendered="#{fichaMB.mostrarModulo('Localizaciones')}" styleClass="col-sm-3"
                                    style="#{fichaMB.selectedMostrar == 9 ? 'width: 100%; padding-right:25px' : ''}" >
                        <ui:include src="./../fragmentos/fichaFragmentosLocalizacion.xhtml"/>
                    </ice:panelGroup>

                    <!-- PANEL Wekan ID = 10 -->
                    <ice:panelGroup rendered="#{fichaMB.mostrarModulo('Wekan')}" styleClass="col-sm-3"
                                    style="#{fichaMB.selectedMostrar == 10 ? 'width: 100%; padding-right:25px' : ''}" >
                        <ui:include src="./../fragmentos/fichaFragmentosWekan.xhtml"/>
                    </ice:panelGroup>

                </ice:panelGroup>

            </div>

            <f:event type="preRenderView" listener="#{fichaMB.onload}" />

        </ice:panelGroup>
    </o:form>
</ui:composition>