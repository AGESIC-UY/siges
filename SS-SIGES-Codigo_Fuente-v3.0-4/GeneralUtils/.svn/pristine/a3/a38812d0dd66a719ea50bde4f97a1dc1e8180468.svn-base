package com.sofis.generico.utils.generalutils;

import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Date;
import java.util.GregorianCalendar;

/**
 *
 * @author Usuario
 */
public class DatesUtils {

    public static final String CALENDAR_PATTERN = "dd/MM/yyyy";

    public static boolean sonStringIguales(Date s1, Date s2) {
        if (s1 != null) {
            if (s2 != null) {
                return s1.equals(s2);
            } else {
                return false;
            }
        } else {
            return s2 == null;
        }
    }

    /**
     * Compara si dos fechas son iguales tomando en cuenta el año, mes y día.
     *
     * @param d1
     * @param d2
     * @return true si son iguales.
     */
    public static boolean fechasIguales(Date d1, Date d2) {
        if (d1 != null && d2 != null) {
            SimpleDateFormat fmt = new SimpleDateFormat("yyyyMMdd");
            return fmt.format(d1).equals(fmt.format(d2));
        }
        return false;
    }

    public static boolean esMayor(Date d1, Date d2) {
        if (d1 != null && d2 != null) {
            SimpleDateFormat fmt = new SimpleDateFormat("yyyyMMdd");
            Integer d1Int = Integer.parseInt(fmt.format(d1));
            Integer d2Int = Integer.parseInt(fmt.format(d2));
            return d1Int > d2Int;
        }
        return false;
    }

    public static String toStringFormat(Date d, String pattern) {
        if (d != null) {
            if (StringsUtils.isEmpty(pattern)) {
                pattern = CALENDAR_PATTERN;
            }
            SimpleDateFormat sdf = new SimpleDateFormat(pattern);
            return sdf.format(d);
        }
        return "";
    }

    public static Integer diasEntreFechas(Date d1, Date d2) {
        if (d1 != null && d2 != null) {
            long diff = d2.getTime() > d1.getTime() ? (d2.getTime() - d1.getTime()) : (d1.getTime() - d2.getTime());
            Integer diffDays = Math.round(diff / 86400000);
            return diffDays;
        }
        return null;
    }

    public static Date incrementarDias(Date d, int dias) {
        Calendar cal = new GregorianCalendar();
        cal.setTime(d);
        return incrementarDias(cal, dias).getTime();
    }

    public static Calendar incrementarDias(Calendar cal, int dias) {
        cal.add(Calendar.DAY_OF_YEAR, dias);
        return cal;
    }

    /**
     * Retorna true si el año aportado pertenece al rango de fechas.
     *
     * @param inicio
     * @param fin
     * @param anio
     * @return boolean
     */
    public static boolean isAnioEntreFechas(Date inicio, Date fin, int anio) {
        if (inicio != null && fin != null) {
            Calendar calIni = new GregorianCalendar();
            calIni.setTime(inicio);
            Calendar calFin = new GregorianCalendar();
            calFin.setTime(fin);
            if (calIni.get(Calendar.YEAR) <= anio
                    && calFin.get(Calendar.YEAR) >= anio) {
                return true;
            }
        }
        return false;
    }

    public static String sumarHora(String hora1, String hora2) {
        String pattern = "[0-9]*:[0-9]*";
        if (hora1 == null || hora1.trim().isEmpty()) {
            hora1 = "0:00";
        }
        if(!hora2.matches(pattern)){
            try {
                Integer h2 = Integer.valueOf(hora2);
                hora2 = h2.toString() + ":00";
            } catch (NumberFormatException numberFormatException) {
            }
        }

        if (!StringsUtils.isEmpty(hora2) && hora2.matches(pattern)) {
            String[] hora1Split = hora1.split(":");
            String[] hora2Split = hora2.split(":");
            int h1 = Integer.valueOf(hora1Split[0]);
            int m1 = Integer.valueOf(hora1Split[1]);
            int h2 = Integer.valueOf(hora2Split[0]);
            int m2 = Integer.valueOf(hora2Split[1]);

            h1 += h2;
            m1 += m2;
            if (m1 > 59) {
                h1 += m2 / 60;
                m1 += Math.floor((m2 % 60) * 100);
            }

            return h1 + ":" + (m1 < 10 ? "0" + m1 : m1);
        }
        return hora1;
    }
}
