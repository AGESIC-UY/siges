package com.sofis.business.validations;

import com.sofis.entities.constantes.ConstanteApp;
import com.sofis.entities.constantes.ConstantesErrores;
import com.sofis.entities.constantes.MensajesNegocio;
import com.sofis.entities.data.Programas;
import com.sofis.entities.data.SsUsuario;
import com.sofis.exceptions.BusinessException;
import com.sofis.generico.utils.generalutils.StringsUtils;
import java.util.logging.Level;
import java.util.logging.Logger;

/**
 *
 * @author Usuario
 */
public class ProgramaValidacion {

    private static final Logger logger = Logger.getLogger(ConstanteApp.LOGGER_NAME);

    public static boolean validar(Programas prog, SsUsuario usuario, Integer orgPk) throws BusinessException {

        BusinessException be = new BusinessException();
        be.addError(MensajesNegocio.ERROR_PROGRAMA);

        if (prog == null) {
            be.addError(ConstantesErrores.ERROR_DATO_VACIO);
        } else {
            boolean isAlta = prog.getProgPk() == null;

            if (prog.isActivo()) {
                if (prog.getProgOrgFk() == null) {
                    be.addError(MensajesNegocio.ERROR_FICHA_ORGANISMO);
                }
                if (StringsUtils.isEmpty(prog.getProgNombre())) {
                    be.addError(MensajesNegocio.ERROR_FICHA_NOMBRE);
                }
                if (prog.getProgAreaFk() == null) {
                    be.addError(MensajesNegocio.ERROR_FICHA_AREA);
                }
                if (prog.getProgUsrAdjuntoFk() == null) {
                    be.addError(MensajesNegocio.ERROR_FICHA_ADJUNTO);
                }
                if (prog.getProgUsrSponsorFk() == null) {
                    be.addError(MensajesNegocio.ERROR_FICHA_SPONSOR);
                }
                if (prog.getProgUsrGerenteFk() == null) {
                    be.addError(MensajesNegocio.ERROR_FICHA_GERENTE);
                }
                if (prog.getProgSemaforoAmarillo() == null || prog.getProgSemaforoAmarillo() <= 0) {
                    be.addError(MensajesNegocio.ERROR_FICHA_SEMAFORO_AMARILLO);
                }
                if (prog.getProgSemaforoRojo() == null || prog.getProgSemaforoRojo() <= 0) {
                    be.addError(MensajesNegocio.ERROR_FICHA_SEMAFORO_ROJO);
                }
                if (prog.getActivo() == null) {
                    be.addError(MensajesNegocio.ERROR_FICHA_ACTIVO);
                }

                if (!isAlta) {
                    if (prog.getProgUsrPmofedFk() == null) {
                        be.addError(MensajesNegocio.ERROR_FICHA_PMOF);
                    }
                    if (prog.isProgPubWeb()) {
                        if (prog.getProgUsrEditorFk() == null) {
                            be.addError(MensajesNegocio.ERROR_FICHA_EDITOR);
                        }
                        if (prog.getProgUsrEditorPublicaFk() == null) {
                            be.addError(MensajesNegocio.ERROR_FICHA_EDITOR_PUBLICA);
                        }
                    }
                }

//                if (ProgProyUtils.isUsuarioPMOF(prog, usuario, orgPk)
//                        && (prog.getProgEstFk().isEstado(Estados.ESTADOS.INICIO.estado_id)
//                        || prog.getProgEstFk().isEstado(Estados.ESTADOS.PLANIFICACION.estado_id)
//                        || prog.getProgEstFk().isEstado(Estados.ESTADOS.EJECUCION.estado_id))) {
//                    if (StringsUtils.isEmpty(prog.getProgObjetivo())) {
//                        be.addError(MensajesNegocio.ERROR_FICHA_OBJETIVO);
//                    }
//                    if (StringsUtils.isEmpty(prog.getProgObjPublico())) {
//                        be.addError(MensajesNegocio.ERROR_FICHA_PUBLICO_OBJ);
//                    }
//                }
            }
        }

        if (be.getErrores().size() > 1) {
            logger.logp(Level.INFO, ProgramaValidacion.class.getName(), "validar", be.getErrores().toString(), be);
            throw be;
        }

        return true;
    }
}
