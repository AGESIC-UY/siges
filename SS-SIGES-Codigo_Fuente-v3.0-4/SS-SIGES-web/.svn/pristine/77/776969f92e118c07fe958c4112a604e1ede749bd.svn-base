<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ace="http://www.icefaces.org/icefaces/components"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:icecore="http://www.icefaces.org/icefaces/core"
                xmlns:ice="http://www.icesoft.com/icefaces/component"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions">

    <ice:panelGroup styleClass="col-sm-12 subtituloReporte margen-inf">
        <ice:outputText value="#{labels.reporte_titulo_cronograma}"/>
    </ice:panelGroup>

    <ice:panelGroup styleClass="RefLineaBase" rendered="#{not empty reporteProyectoMB.histReplanificacion}">
        <b><ice:outputText value="#{labels.reporte_crono_ref_linea_base}" /></b>
        <c:forEach var="histReplan" items="#{reporteProyectoMB.histReplanificacion}">
            <div class="cadaEntHistLineaBase">
                <ice:outputText value="#{histReplan.proyreplanPk} - "/>
                <ice:outputText value="#{histReplan.proyreplanFecha}"
                                converter="fechaConverter"/>
                <ice:outputText value=" - #{histReplan.proyreplanDesc}"/>
            </div>
        </c:forEach>
    </ice:panelGroup>

    <ice:panelGroup styleClass="anioProducto">
        <ice:commandLink action="#{reporteProyectoMB.retrocederAnio()}" 
                         rendered="#{reporteProyectoMB.contieneAnioMenor()}">
            <ice:graphicImage value="../img/atrasar-fase.png" />
        </ice:commandLink>
        <ice:outputText value="#{reporteProyectoMB.anio}" title="#{labels.reporte_proy_anio_desplegado}"/>
        <ice:commandLink action="#{reporteProyectoMB.avanzarAnio()}"
                         rendered="#{reporteProyectoMB.contieneAnioMayor()}">
            <ice:graphicImage value="../img/adelantar-fase.png" />
        </ice:commandLink>
    </ice:panelGroup>

    <ice:panelGroup>
        <div class="reporteFicha">
            <div class="cabezalMeses prodItem">
                <span class="prodItemTitle primerEspacio"></span>
                <c:forEach begin="1" step="1" end="12" var="mes">
                    <span class="prodItemTitle"><ice:outputText value="#{reportesMB.mesAbreviadoStr(mes)}"/></span>
                </c:forEach>
            </div>

            <div class="tituloReporte">
                <span>Cronograma</span>
            </div>

            <c:forEach var="ent" items="#{reporteProyectoMB.listaEntregables}">
                <c:set var="dia" value="#{reporteProyectoMB.calcularLeftDia()}px" />

                <!-- Entregable -->
                <div class="cadaEntregable #{reporteProyectoMB.displayDayRef() ? 'marcaFecha' : ''}"
                     style="background-position: #{dia};">
                    <span class="prodItemTitle primerEspacio">
                        <ice:outputText value="#{ent.entNombre}" style="#{reporteProyectoMB.entregableTieneClave(ent.entPk, 1) ? 'color: #ff0000;' : ''} "/>
                        (<ice:outputText value="#{ent.entInicioDate}" 
                                         converter="fechaConverter" /> - 
                        <ice:outputText value="#{ent.entFinDate}" 
                                        converter="fechaConverter" />)
                    </span>
                    <div class="tablaMeses">
                        <c:set var="left" value="#{reporteProyectoMB.calcularLeftEntByDate(ent.entInicioDate)}px" />
                        <c:set var="width" value="#{reporteProyectoMB.calcularWitdhEntByDate(ent.entInicioDate, ent.entFinDate, ent.entDuracion)}px" />
                        <c:set var="display" value="#{reporteProyectoMB.displayEnt(ent) ? '' : 'none'}" />
                        <div class="indice3color" style="left:#{left}; width:#{width}; display:#{display};">
                            <c:if test="#{ent.padre}">
                                <div class="" style="width: 100%;background-color: #bababa;">&nbsp;</div>
                            </c:if>
                            <c:if test="#{!ent.padre}">
                                <!-- barritas de colores -->
                                <c:set var="progresoPorc" value="#{ent.entProgreso}%" />
                                <c:set var="faltante" value="#{100 - ent.entProgreso}" />
                                <c:set var="faltantePorc" value="#{faltante}%" />
                                <div class="indice3colorBlue" style="width:#{progresoPorc}">#{ent.entProgreso}%</div>
                                <div class="#{reporteProyectoMB.entAtrasado(ent) ? 'indice3colorRed':'indice3colorGreen'}" style="width:#{faltantePorc}">#{faltante}%</div>
                            </c:if>
                        </div>
                    </div>
                </div>

                <!-- Linea Base -->
                <c:if test="#{ent.entInicioLineaBaseDate != null and ent.entFinLineaBaseDate != null}" >
                    <div class="cadaEntHistLineaBase #{reporteProyectoMB.displayDayRef() ? 'marcaFecha' : ''}"
                         style="background-position: #{dia};">
                        <span class="prodItemTitle primerEspacio">
                            <ice:outputText value="#{labels.reporte_crono_linea_base}"/>
                            (<ice:outputText value="#{ent.entInicioLineaBaseDate}" 
                                             converter="fechaConverter" /> - 
                            <ice:outputText value="#{ent.entFinLineaBaseDate}" 
                                            converter="fechaConverter" />)
                        </span>
                        <div class="tablaMeses">
                            <c:set var="left" value="#{reporteProyectoMB.calcularLeftEntByDate(ent.entInicioLineaBaseDate)}px" />
                            <c:set var="width" value="#{reporteProyectoMB.calcularWitdhEntByDate(ent.entInicioLineaBaseDate, ent.entFinLineaBaseDate, ent.entDuracionLineaBase)}px" />
                            <c:set var="display" value="#{reporteProyectoMB.displayEntLineaBase(ent) ? '' : 'none'}" />
                            <div class="lineaBase" style="left:#{left}; width:#{width}; display:#{display};" />
                        </div>
                    </div>
                </c:if>

                <!-- Historico Linea Base -->
                <c:if test="#{reporteProyectoMB.cronoHistorico}" >
                    <c:forEach var="entHist" items="#{ent.entHistLBSet}">
                        <div class="cadaEntHistLineaBase #{reporteProyectoMB.displayDayRef() ? 'marcaFecha' : ''}"
                             style="background-position: #{dia};">
                            <span class="prodItemTitle primerEspacio">
                                <ice:outputText value="#{entHist.enthistFecha}"
                                                converter="fechaConverter"/>
                                (<ice:outputText value="#{entHist.enthistInicioLineaBaseDate}" 
                                                 converter="fechaConverter" /> - 
                                <ice:outputText value="#{entHist.enthistFinLineaBaseDate}" 
                                                converter="fechaConverter" />)
                                <ice:outputText value="#{labels.reporte_crono_ref}: #{entHist.enthistReplanFk.proyreplanPk}"
                                                rendered="#{entHist.enthistReplanFk.proyreplanPk != null}"/>
                            </span>
                            <div class="tablaMeses">
                                <c:set var="left" value="#{reporteProyectoMB.calcularLeftEntByDate(entHist.enthistInicioLineaBaseDate)}px" />
                                <c:set var="width" value="#{reporteProyectoMB.calcularWitdhEntByDate(entHist.enthistInicioLineaBaseDate, entHist.enthistFinLineaBaseDate, entHist.enthistDuracion)}px" />
                                <c:set var="display" value="#{reporteProyectoMB.displayEntHist(entHist) ? '' : 'none'}" />
                                <div class="lineaBase" style="left:#{left}; width:#{width}; display:#{display};" />
                            </div>
                        </div>
                    </c:forEach>
                </c:if>
            </c:forEach>
        </div>
    </ice:panelGroup>

    <ice:panelGroup id="infoReferenciaColoresGantt">
        <ice:outputText value="#{reporteProyectoMB.coloresGantt()}" escape="false" />
        <ice:outputText value="#{labels.reporte_crono_ref_tabla}" escape="false" />
    </ice:panelGroup>

</ui:composition>