<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ace="http://www.icefaces.org/icefaces/components"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:icecore="http://www.icefaces.org/icefaces/core"
                xmlns:ice="http://www.icesoft.com/icefaces/component">

    <ice:panelGroup id="panelParticipantes" 
                    style="#{fichaMB.selectedMostrar == 6 ? 'width: 100%; padding-right:25px' : ''}" 
                    styleClass="col-sm-6 cuadro" 
                    rendered="#{inicioMB.verDos and (fichaMB.selectedMostrar == null || fichaMB.selectedMostrar == 6) and fichaMB.fieldRendered('panelInteresados')}">

        <ice:panelGroup id="cabezalParticipantes" styleClass="cabezal">
            <ice:outputText value="#{labels.participantes}"/>
            <ace:pushButton value="" action="#{fichaMB.miMostrar(6)}" 
                            styleClass="#{fichaMB.selectedMostrar == 6 ? 'botonMinimizar' : 'botonAgregar'} iconoTabla"/>
        </ice:panelGroup>

        <!--El panel con el resumen de participantes -->
        <ice:panelGroup  styleClass="cuerpo" rendered="#{not fichaMB.mostrar[6]}">
            <ace:dataTable id="participantesTable"
                           value="#{fichaMB.listaParticipantesResumen}"
                           styleClass="tablaFicha no-margin"
                           var="part"
                           rendered="#{not empty fichaMB.listaParticipantesResumen}"
                           paginator="true"
                           paginatorPosition="bottom"
                           rows="10">
                <ace:column id="id_int">
                    <h:outputText id="idCell" value="#{part.partUsuarioFk != null ?  part.partUsuarioFk.getUsuNombreApe(20) : ''}"
                                  title="#{part.partUsuarioFk != null ?  part.partUsuarioFk.usuNombreApellido : ''}"/>
                </ace:column>

                <ace:column headerText="#{labels.carga_hs_aprobadas}">
                    <h:outputText value="#{part.horasAprobadas}"/>
                </ace:column>
                <ace:column headerText="#{labels.carga_hs_pendientes}">
                    <h:outputText value="#{part.horasPendientes}"/>
                </ace:column>
            </ace:dataTable>

            <ice:panelGroup rendered="#{empty fichaMB.listaParticipantesResumen}">
                <ice:outputText value="Sin Participantes" />
            </ice:panelGroup>

        </ice:panelGroup>

        <!--El panel con el modulo Participantes -->
        <ice:panelGroup rendered="#{fichaMB.mostrar[6]}" styleClass="cuerpo">

            <ice:panelGroup id="participantesForm">
                <ice:panelCollapsible expanded="#{fichaMB.partFormDataExpanded}" 
                                      rendered="#{revisionHorasMB.renderedHorasGastos==0}">
                    <f:facet name="header">
                        <h:panelGrid columns="1">
                            <h:commandButton value="#{labels.agregarParticipante}" 
                                             rendered="#{!fichaMB.partFormDataExpanded and fichaMB.fieldRendered('agregarParticipante')}"
                                             styleClass="boton principal #{revisionHorasMB.participante.partPk ne null ? 'editar' : 'agregar'}" />
                        </h:panelGrid>
                    </f:facet>

                    <ice:panelGroup id="participantesFormData">
                        <ice:panelGrid  styleClass="formulario " columns="4">

                            <ice:outputLabel value="#{labels.revisionHoras_part_usuario}:" />
                            <ice:selectOneMenu value="#{revisionHorasMB.listaUsuariosCombo.selected}"
                                               disabled="#{revisionHorasMB.participante.partPk != null}">
                                <f:selectItems value="#{revisionHorasMB.listaUsuariosCombo.items}" />
                            </ice:selectOneMenu>
                            
                            <ice:outputLabel value="#{labels.revisionHoras_entregable}:" />
                            <ice:selectOneMenu value="#{revisionHorasMB.listaEntregablesCombo.selected}">
                                <f:selectItems value="#{revisionHorasMB.listaEntregablesCombo.items}" />
                            </ice:selectOneMenu>

                            <ice:outputLabel value="#{labels.revisionHoras_part_activo}:" />
                            <ace:checkboxButton value="#{revisionHorasMB.participante.partActivo}" />

                            <ice:outputLabel value="#{labels.revisionHoras_part_horas_plan}:" />
                            <ice:inputText value="#{revisionHorasMB.participante.partHorasPlan}" styleClass="textoCorto" />
                        </ice:panelGrid>

                    </ice:panelGroup> 

                    <ice:panelGroup styleClass="panelBotones">
                        <ace:messages id="participantesMsg"/>
                        <ace:pushButton value="#{labels.guardar}" 
                                        styleClass="boton principal guardar"
                                        action="#{revisionHorasMB.guardarParticipanteAction()}"/>
                        <ace:linkButton  value="#{labels.cerrar}" styleClass="boton secundario" 
                                         action="#{revisionHorasMB.cerrarFormCollapsable()}"/>
                    </ice:panelGroup>
                </ice:panelCollapsible>
            </ice:panelGroup>


            <!-- Lista de participantes-->
            <ice:panelGroup id="participanteList" styleClass="resultado recuadro"
                            rendered="#{revisionHorasMB.renderedHorasGastos==0}">
                <ice:panelGrid rendered="#{not empty fichaMB.listaParticipantes}" width="100%" >
                    <ace:dataTable id="tblResultados1" 
                                   value="#{fichaMB.listaParticipantes}" 
                                   var="part"
                                   paginator="true" pageCount="5" 
                                   rows="#{configuracionMB.cantElementosPorPagina}">
                        <ace:column headerText="#{labels.inicio_col_Nombre}" >
                            <h:outputText value="#{part.partUsuarioFk.getUsuNombreApe(45)}"
                                          title="#{part.partUsuarioFk.usuNombreApellido}"
                                          rendered="#{!part.partActivo}"/>
                            <ice:commandLink action="#{revisionHorasMB.cambiarUsuDetalleHs(part, null)}" 
                                             value="#{part.partUsuarioFk.getUsuNombreApe(45)}"
                                             title="#{part.partUsuarioFk.usuNombreApellido}"
                                             rendered="#{part.partActivo}"/>
                        </ace:column>

                        <ace:column headerText="#{labels.hCorreo}">
                            <h:outputText value="#{part.partUsuarioFk != null ?  part.partUsuarioFk.usuCorreoElectronico : ''}"/>
                        </ace:column>
                        <!-- Col. Gastos -->
                        <ace:column headerText="#{labels.revisionHoras_gasto_aprobadas}"
                                    styleClass="colRight">
                            <h:outputText value="#{revisionGastosMB.monedaImporteTxt(part.gastosAprobados)}"
                                          escape="false"
                                          rendered="#{!part.partActivo}"/>
                            <ice:commandLink action="#{revisionGastosMB.cambiarUsuDetalleGastos(part, 1)}" 
                                             title="Ver las aprobadas."
                                             rendered="#{part.partActivo}">
                                <h:outputText value="#{revisionGastosMB.monedaImporteTxt(part.gastosAprobados)}"
                                              escape="false"
                                              rendered="#{part.partActivo}"/>
                            </ice:commandLink>
                        </ace:column>

                        <ace:column headerText="#{labels.revisionHoras_gasto_pendientes}"
                                    styleClass="colRight">
                            <h:outputText value="#{revisionGastosMB.monedaImporteTxt(part.gastosPendientes)}"
                                          escape="false"
                                          rendered="#{!part.partActivo}"/>
                            <ice:commandLink action="#{revisionGastosMB.cambiarUsuDetalleGastos(part, 0)}" 
                                             title="Ver las no aprobadas."
                                             styleClass="linkRojo"
                                             rendered="#{part.partActivo}">
                            <h:outputText value="#{revisionGastosMB.monedaImporteTxt(part.gastosPendientes)}"
                                              escape="false"
                                              rendered="#{part.partActivo}"/>
                            </ice:commandLink>
                        </ace:column>
                        <!-- Col. Horas -->
                        <ace:column headerText="#{labels.revisionHoras_hs_planificadas}"
                                    styleClass="colRight">
                            <h:outputText value="#{part.partHorasPlan}"
                                          converter="decimalFormatConverter"/>
                        </ace:column>

                        <ace:column headerText="#{labels.revisionHoras_hs_aprobadas}"
                                    styleClass="colRight">
                            <h:outputText value="#{part.horasAprobadas}"
                                          rendered="#{!part.partActivo}"
                                          converter="decimalFormatConverter"/>
                            <ice:commandLink action="#{revisionHorasMB.cambiarUsuDetalleHs(part, 1)}" 
                                             title="Ver las aprobadas."
                                             rendered="#{part.partActivo}">
                            <h:outputText value="#{part.horasAprobadas}"
                                          converter="decimalFormatConverter"/>
                            </ice:commandLink>
                        </ace:column>

                        <ace:column headerText="#{labels.revisionHoras_hs_pendientes}"
                                    styleClass="colRight">
                            <h:outputText value="#{part.horasPendientes}"
                                          rendered="#{!part.partActivo}"
                                          converter="decimalFormatConverter"/>
                            <ice:commandLink action="#{revisionHorasMB.cambiarUsuDetalleHs(part, 0)}" 
                                             title="Ver las no aprobadas."
                                             styleClass="linkRojo" 
                                             rendered="#{part.partActivo}">
                                <h:outputText value="#{part.horasPendientes}"
                                          converter="decimalFormatConverter"/>
                            </ice:commandLink>
                        </ace:column>

                        <ace:column styleClass="columnaBoton">
                            <h:commandButton id="btnRevisarHoras"
                                             action="#{revisionHorasMB.cambiarUsuDetalleHs(part, null)}" 
                                             title="Revisar Horas"
                                             styleClass="iconoTabla botonVer"/>
                        </ace:column>

                        <ace:column styleClass="columnaBoton">
                            <h:commandButton styleClass="botonEditar iconoTabla" 
                                             action="#{revisionHorasMB.editarPart(part)}"
                                             title="#{labels.revisionHoras_editar_part}"/>
                        </ace:column>

                        <ace:column styleClass="columnaBoton"
                                    rendered="#{fichaMB.fieldRendered('eliminarParticipante')}">
                            <h:commandButton id="btnEliminarParticipante"
                                             styleClass="botonEliminar iconoTabla" 
                                             title="#{labels.revisionHoras_eliminar_part}"
                                             onclick="confirmationEliminarPart#{part.partPk}.show();"
                                             rendered="#{part.partActivo}"/>
                            <ace:confirmationDialog widgetVar="confirmationEliminarPart#{part.partPk}" 
                                                    message="#{labels.confirmacionEliminacion}"
                                                    header="#{labels.hConfirmacion}"
                                                    closable="true"
                                                    closeOnEscape="true"
                                                    severity="info"
                                                    modal="true"
                                                    position="center">
                                <h:panelGrid columns="2" styleClass="centeredPanelGrid">
                                    <h:commandButton id="yesDelPart"
                                                     value="#{labels.si}"
                                                     styleClass="boton principal botonContinuar"
                                                     onclick="confirmationEliminarPart#{part.partPk}.hide();" 
                                                     actionListener="#{revisionHorasMB.eliminarParticipanteAction(part.partPk)}"/>
                                    <h:commandButton id="noDelPart"
                                                     value="#{labels.no}"
                                                     styleClass="boton principal botonEliminar"
                                                     onclick="confirmationEliminarPart#{part.partPk}.hide();"  />
                                </h:panelGrid>
                            </ace:confirmationDialog>
                        </ace:column>
                    </ace:dataTable>
                </ice:panelGrid>

                <ice:panelGrid rendered="#{empty fichaMB.listaParticipantes}" width="100%">
                    <ice:outputText value="#{labels.noHayParticipantes}"/>
                </ice:panelGrid>
            </ice:panelGroup>

            <!-- Lista de Horas -->
            <ui:include src="./fichaFragmentosParticipantesHoras.xhtml" />
            <!-- Lista de Gastos -->
            <ui:include src="./fichaFragmentosParticipantesGastos.xhtml" />
        </ice:panelGroup>

    </ice:panelGroup>
</ui:composition>