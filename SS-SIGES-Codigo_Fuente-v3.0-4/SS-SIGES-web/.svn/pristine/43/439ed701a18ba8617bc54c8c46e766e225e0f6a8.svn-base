<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ace="http://www.icefaces.org/icefaces/components"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:icecore="http://www.icefaces.org/icefaces/core"
                xmlns:ice="http://www.icesoft.com/icefaces/component">

    <script type="text/javascript">
        // slight update to account for browsers not supporting e.which
        function disableF5(e) {
            if ((e.which || e.keyCode) == 116)
                e.preventDefault();
        }
        ;
        // To disable f5
        // jQuery menor a 1.7
        $(document).bind("keydown", disableF5);
        /* OR jQuery >= 1.7 */
        $(document).on("keydown", disableF5);
    </script>

    <ice:form id="ficha" 
              rendered="#{!inicioMB.usuarioAdmin}">
        <ace:textEntry style="display: none" id="diaHoraServer" value="#{fichaMB.diaHoraServer}"/>
        <!-- Titulo -->
        <ice:panelGroup id="tituloPagina" styleClass="tituloPagina">
            <ice:outputLabel value="#{labels.tituloFicha}"/>
            <ice:commandLink id="linkEditarFichaActual"
                             action="#{inicioMB.irEditarProgramaProyecto(fichaMB.fichaTO.fichaFkTipo, false)}" 
                             value="(#{fichaMB.fichaTO.fichaFk})"
                             rendered="#{fichaMB.fichaTO.fichaFk != null}"
                             title="#{labels.actualizar}"/>
        </ice:panelGroup>

        <!-- Datos generales de la ficha -->
        <ice:panelGroup id="ficha_datos_generales" styleClass="fichaDatosGenerales" >

            <ice:panelGroup id="fichaIzq" styleClass="fondo-gris col-sm-8 recuadro formulario">
                <ice:panelGroup styleClass="col-sm-6">
                    <ice:selectOneRadio disabled="#{fichaMB.fieldDisabled('tipoFicha')}" 
                                        partialSubmit="true" 
                                        value="#{fichaMB.fichaTO.tipoFicha}" 
                                        styleClass="radioButton">
                        <f:selectItem itemValue="1" itemLabel="Programa" />
                        <f:selectItem itemValue="2" itemLabel="Proyecto" />
                    </ice:selectOneRadio >
                </ice:panelGroup>

                <ice:panelGroup styleClass="col-sm-6 no-padding fichaUltAct">
                    <ice:outputLabel value="#{labels.ficha_fechaActualizacion}:&nbsp;"
                                     rendered="#{fichaMB.fichaTO.fechaAct != null}"/>
                    <ice:outputText value="#{fichaMB.fichaTO.fechaAct}" 
                                    converter="fechaConverter"
                                    rendered="#{fichaMB.fichaTO.fechaAct != null}"/>
                    <ice:commandButton style="background-color: #{fichaMB.fichaTO.fechaActColor};"
                                       styleClass="botonSemaforo" 
                                       disabled="true"
                                       rendered="#{fichaMB.fichaTO.fechaActColor != null}"/>
                </ice:panelGroup>

                <ice:panelGroup styleClass="col-sm-12 no-padding">
                    <ice:panelGroup styleClass="col-sm-2">
                        <ice:outputLabel value="#{labels.nombreProgProy}:" />
                    </ice:panelGroup>
                    <ice:panelGroup styleClass="col-sm-10">
                        <ace:textEntry disabled="#{fichaMB.fieldDisabled('Nombre')}"
                                       value="#{fichaMB.fichaTO.nombre}"
                                       style="width:100%;"/>
                    </ice:panelGroup>
                </ice:panelGroup>

                <ice:panelGroup rendered="#{fichaMB.fieldRendered('resumenEjecutivo', fichaMB.fichaTO.resumenEjecutivo) and fichaMB.downloadFile[fichaMB.fichaTO.resumenEjecutivo.docsPk] != null}"
                                styleClass="linkFichaRight">
                    <c:set var="labelLinkResumenEjecutivo" value="#{labels.verResumenEjecutivoFicha} #{fichaMB.fichaTO.resumenEjecutivo != null and fichaMB.fichaTO.resumenEjecutivo.docsTipo != null and fichaMB.fichaTO.resumenEjecutivo.docsTipo.tipodocInstTipoDocFk != null ? fichaMB.fichaTO.resumenEjecutivo.docsTipo.tipodocInstTipoDocFk.tipodocNombre : ''}" />
                    <ice:outputResource 
                        rendered="#{fichaMB.downloadFile[fichaMB.fichaTO.resumenEjecutivo.docsPk] != null}"
                        resource="#{fichaMB.downloadFile[fichaMB.fichaTO.resumenEjecutivo.docsPk]}"
                        label="#{labelLinkResumenEjecutivo}"
                        fileName="#{fichaMB.downloadFile[fichaMB.fichaTO.resumenEjecutivo.docsPk] != null ? fichaMB.downloadFile[fichaMB.fichaTO.resumenEjecutivo.docsPk].docFile.docfileNombre : 'file'}"/>
                </ice:panelGroup>

                <ice:panelGroup styleClass="col-sm-12">
                    <ice:outputLabel value="#{labels.descFicha}"/>
                    <ace:richTextEntry id="descripcion"
                                       value="#{fichaMB.fichaTO.descripcion}" 
                                       disabled="#{fichaMB.fieldDisabled('Descripcion')}"
                                       rendered="#{fichaMB.fieldRendered('Descripcion')}"
                                       toolbar="Basic" immediate="true" language="es"
                                       skin="kama" saveOnSubmit="true"
                                       styleClass="ancho100" height="80px" />

                    <ice:panelGroup styleClass="recuadro"
                                    rendered="#{!fichaMB.fieldRendered('Descripcion')}">
                        <ice:outputText rendered="#{!fichaMB.fieldRendered('Descripcion')}"
                                        value="#{fichaMB.fichaTO.descripcion}"
                                        escape="false"/>
                    </ice:panelGroup>
                </ice:panelGroup>

                <ice:panelGroup styleClass="col-sm-12">
                    <ice:outputLabel value="#{labels.objFicha}"/>
                    <ace:richTextEntry id="objetivo"
                                       value="#{fichaMB.fichaTO.objetivo}" 
                                       disabled="#{fichaMB.fieldDisabled('Objetivo')}"
                                       rendered="#{fichaMB.fieldRendered('Objetivo')}"
                                       toolbar="Basic" immediate="true" language="es"
                                       skin="kama" saveOnSubmit="true"
                                       styleClass="ancho100" height="80px" />

                    <ice:panelGroup styleClass="recuadro"
                                    rendered="#{!fichaMB.fieldRendered('Objetivo')}">
                        <ice:outputText rendered="#{!fichaMB.fieldRendered('Objetivo')}"
                                        value="#{fichaMB.fichaTO.objetivo}"
                                        escape="false"/>
                    </ice:panelGroup>
                </ice:panelGroup>

                <ice:panelGroup styleClass="col-sm-12">
                    <ice:outputLabel value="#{labels.objPublicoFicha}"/>
                    <ace:richTextEntry id="objPublico"
                                       value="#{fichaMB.fichaTO.objPublico}" 
                                       disabled="#{fichaMB.fieldDisabled('PubObjetivo')}"
                                       rendered="#{fichaMB.fieldRendered('PubObjetivo')}"
                                       toolbar="Basic" immediate="true" language="es"
                                       skin="kama" saveOnSubmit="true" 
                                       styleClass="ancho100" height="80px"/>
                    <ice:panelGroup styleClass="recuadro"
                                    rendered="#{!fichaMB.fieldRendered('PubObjetivo')}">
                        <ice:outputText rendered="#{!fichaMB.fieldRendered('PubObjetivo')}"
                                        value="#{fichaMB.fichaTO.objPublico}"
                                        escape="false"/>
                    </ice:panelGroup>
                </ice:panelGroup>

                <ice:panelGroup id="panelSituacionActual" styleClass="col-sm-12"
                                rendered="#{fichaMB.fichaTO.proyecto}">
                    <ice:outputLabel value="#{labels.ficha_situacionActualFicha} #{fichaMB.fechaUltimaSitAct}:"/>

                    <ice:commandLink action="#{fichaMB.verHistoricoSitActAction()}" 
                                     value="#{labels.ficha_historico_sitact}" 
                                     title="#{labels.ficha_historico_sitact}"
                                     styleClass="linkFichaRight"/>

                    <ace:richTextEntry id="situacionActual"
                                       value="#{fichaMB.fichaTO.situacionActual}" 
                                       disabled="#{fichaMB.fieldDisabled('SitActual')}"
                                       rendered="#{fichaMB.fieldRendered('SitActual')}"
                                       toolbar="Basic" immediate="true" language="es" 
                                       skin="kama" saveOnSubmit="true" 
                                       styleClass="ancho100" height="100px" />
                    <ice:panelGroup styleClass="recuadro"
                                    rendered="#{!fichaMB.fieldRendered('SitActual')}">
                        <ice:outputText rendered="#{!fichaMB.fieldRendered('SitActual')}"
                                        value="#{fichaMB.fichaTO.situacionActual}"
                                        escape="false"/>
                    </ice:panelGroup>
                </ice:panelGroup>

                <ice:commandLink action="#{fichaMB.linkToGRP()}" 
                                 value="#{labels.ficha_grp_link}"
                                 title="#{labels.ficha_grp_link}"
                                 rendered="#{not empty fichaMB.fichaTO.grp}"/>


                <ice:panelGroup styleClass="col-sm-12 no-padding">
                    <ice:panelGroup rendered="#{fichaMB.fichaTO.proyecto}" styleClass="panelEstadoProducto">
                        <ice:panelGroup styleClass="form-group">
                            <ice:outputLabel value="#{labels.ficha_publicar_visualizador}:"/>
                            <ace:checkboxButton value="#{fichaMB.fichaTO.publicable}" />
                        </ice:panelGroup>

                        <ice:panelGroup styleClass="form-group">
                            <ice:outputLabel value="#{labels.ficha_estado_producto}:"
                                             styleClass="col-sm-3"/>
                            <ice:panelGroup styleClass="col-sm-3">
                                <ice:selectOneMenu id="comboEstadoProd" value="#{fichaMB.listaEtapaPubCombo.selected}"
                                                   disabled="#{fichaMB.fieldDisabled('EtapaPublicacion')}"
                                                   styleClass="textoMedio">
                                    <f:selectItems value="#{fichaMB.listaEtapaPubCombo.items}"/>
                                </ice:selectOneMenu>
                            </ice:panelGroup>

                            <ice:outputLabel value="#{labels.ficha_estado_publicacion}:"
                                             rendered="false"
                                             styleClass="col-sm-3"/>
                            <ice:outputText value="#{fichaMB.estadoPublicacionStr()}"
                                            rendered="false"
                                            styleClass="col-sm-3"/>
                        </ice:panelGroup>

                    </ice:panelGroup>

                    <ice:panelGroup style="clear: both" id="estadoFicha">
                        <img class="img-responsive fases" src="./../img/#{fichaMB.imgEstado}"/>
                        <ice:outputText value="#{fichaMB.solCambioEstadoStr()}" />
                    </ice:panelGroup>

                    <ice:panelGroup styleClass="panelAcciones">
                        <ice:panelGroup styleClass="centrado panelBotones margen-sup">
                            <ace:pushButton rendered="#{fichaMB.fieldRendered('retrocederEstadoFicha')}" 
                                            style="margin-left: 10px;"
                                            value="#{fichaMB.labelBtnEstAnterior}" 
                                            action="#{fichaMB.retrocederEstadoFichaAction()}" 
                                            styleClass="boton principal atras"/>

                            <ace:pushButton rendered="#{fichaMB.fieldRendered('AprobarFicha')}" 
                                            style="margin-left: 10px;"
                                            value="#{fichaMB.labelBtnAprobar}" 
                                            action="#{fichaMB.guardarAprobarFichaAction()}" 
                                            styleClass="boton principal adelante"/>

                            <ace:confirmationDialog id="confirmDialogAprobar"
                                                    widgetVar="confirmationEliminar"
                                                    message="#{labels.confirmacionEliminacion}"
                                                    header="#{labels.hConfirmacion}"
                                                    closable="true"
                                                    closeOnEscape="true"
                                                    severity="info"
                                                    modal="true"
                                                    position="center">
                                <h:panelGrid columns="2" styleClass="centeredPanelGrid">
                                    <h:commandButton id="yesAprobar"
                                                     value="#{labels.si}"
                                                     styleClass="boton principal botonContinuar"
                                                     onclick="confirmationEliminar.hide()" 
                                                     actionListener="#{fichaMB.eliminarFichaAction()}"/>
                                    <h:commandButton id="noAprobar"
                                                     value="#{labels.no}"
                                                     styleClass="boton principal botonEliminar"
                                                     onclick="confirmationEliminar.hide()"  />
                                </h:panelGrid>
                            </ace:confirmationDialog> 
                        </ice:panelGroup>
                    </ice:panelGroup>
                </ice:panelGroup>

            </ice:panelGroup>

            <ice:panelGroup id="fichaDer" styleClass="col-sm-4 no-padding">
                <ice:panelGroup id="fichaProgProyPMO1_Parte1" styleClass="formulario recuadro">
                    <ice:panelGroup rendered="#{fichaMB.fieldRendered('Area')}">
                        <ice:outputLabel value="#{labels.areaOrganizacionFicha}:"
                                         styleClass="col-sm-3"/>
                        <ice:selectOneMenu id="comboAreas" value="#{fichaMB.listaAreasOrganismoCombo.selected}"
                                           disabled="#{fichaMB.fieldDisabled('Area')}"
                                           styleClass="col-sm-9">
                            <f:selectItems value="#{fichaMB.listaAreasOrganismoCombo.items}"/>
                        </ice:selectOneMenu>
                    </ice:panelGroup>

                    <ice:panelGroup rendered="#{fichaMB.fieldRendered('Programas')}">
                        <ice:panelGroup styleClass="col-sm-9">
                            <ice:outputLabel value="#{labels.programaFicha}:"
                                             styleClass="col-sm-4"/>
                            <ice:selectOneMenu id="comboProgramas" 
                                               value="#{fichaMB.listaProgramasCombo.selected}" 
                                               disabled="#{fichaMB.fieldDisabled('Programas')}" 
                                               valueChangeListener="#{fichaMB.progSetPeso}"
                                               partialSubmit="true"
                                               styleClass="col-sm-8">
                                <f:selectItems value="#{fichaMB.listaProgramasCombo.items}" />
                            </ice:selectOneMenu>
                        </ice:panelGroup>

                        <ice:panelGroup styleClass="col-sm-3 peso">
                            <ice:outputLabel value="#{labels.pesoFicha}"
                                             styleClass="col-sm-4"/>
                            <ace:textEntry value="#{fichaMB.fichaTO.peso}" 
                                           styleClass="col-sm-4" 
                                           disabled="#{fichaMB.fieldDisabled('Peso')}"
                                           rendered="#{fichaMB.fieldRendered('Peso')}"
                                           converter="IntegerFormatConverter" 
                                           converterMessage="#{labels.error_ingreso_incorrecto}"/>
                        </ice:panelGroup>
                    </ice:panelGroup>

                    <ice:panelGroup rendered="#{fichaMB.fieldRendered('Gerente')}">
                        <ice:outputLabel value="#{labels.gerenteFicha}"
                                         styleClass="col-sm-3"/>
                        <ice:selectOneMenu id="comboGerente" value="#{fichaMB.listaGerenteCombo.selected}"
                                           disabled="#{fichaMB.fieldDisabled('Gerente')}"
                                           styleClass="col-sm-9">
                            <f:selectItems value="#{fichaMB.listaGerenteCombo.items}"/>
                        </ice:selectOneMenu>
                    </ice:panelGroup>

                    <ice:panelGroup rendered="#{fichaMB.fieldRendered('Adjunto')}">
                        <ice:outputLabel value="#{labels.adjuntoFicha}"
                                         styleClass="col-sm-3"/>
                        <ice:selectOneMenu id="comboAdjunto" value="#{fichaMB.listaAdjuntoCombo.selected}"
                                           disabled="#{fichaMB.fieldDisabled('Adjunto')}"
                                           styleClass="col-sm-9">
                            <f:selectItems value="#{fichaMB.listaAdjuntoCombo.items}"/>
                        </ice:selectOneMenu>
                    </ice:panelGroup>

                    <ice:panelGroup rendered="#{fichaMB.fieldRendered('Sponsor')}">
                        <ice:outputLabel value="#{labels.sponsorFicha}"
                                         styleClass="col-sm-3"/>
                        <ice:selectOneMenu id="comboSponsor" value="#{fichaMB.listaSponsorCombo.selected}"
                                           disabled="#{fichaMB.fieldDisabled('Sponsor')}"
                                           styleClass="col-sm-9">
                            <f:selectItems value="#{fichaMB.listaSponsorCombo.items}"/>
                        </ice:selectOneMenu>
                    </ice:panelGroup>

                    <ice:panelGroup rendered="#{fichaMB.fieldRendered('PMOFederada')}">
                        <ice:outputLabel value="#{labels.pmoFederadaFicha}:"
                                         styleClass="col-sm-3"/>
                        <ice:selectOneMenu id="comboPMOFed" value="#{fichaMB.listaPmoFederadaCombo.selected}"
                                           disabled="#{fichaMB.fieldDisabled('PMOFederada')}"
                                           styleClass="col-sm-9">
                            <f:selectItems value="#{fichaMB.listaPmoFederadaCombo.items}"/>
                        </ice:selectOneMenu>
                    </ice:panelGroup>

                    <!-- #{labels.fichaConfiguracion}  -->
                    <ice:panelGroup styleClass="semaforo">
                        <ice:panelGroup styleClass="col-sm-4">
                            <ice:outputLabel value="#{labels.tiempoSemaforoAmarillo}"/>  
                            <ace:textEntry value="#{fichaMB.fichaTO.semaforoAmarillo}" 
                                           disabled="#{fichaMB.fieldDisabled('SemaforoAmarillo')}"
                                           style="float:left" styleClass="textoCorto"
                                           converter="IntegerFormatConverter"/>
                        </ice:panelGroup>

                        <ice:panelGroup styleClass="col-sm-4">
                            <ice:outputLabel value="#{labels.tiempoSemaforoRojo}"/>
                            <ace:textEntry value="#{fichaMB.fichaTO.semaforoRojo}" 
                                           disabled="#{fichaMB.fieldDisabled('SemaforoRojo')}"
                                           style="float:left" styleClass="textoCorto"
                                           converter="IntegerFormatConverter"/>
                        </ice:panelGroup>

                        <!--
                        <ice:panelGroup styleClass="col-sm-4">
                            <ice:outputLabel value="# {labels.grpFicha}"/>
                            <ace:textEntry value="# {fichaMB.fichaTO.grp}" 
                                           disabled="# {fichaMB.fieldDisabled('GRP')}" 
                                           style="float:left" styleClass="textoCorto"/>
                        </ice:panelGroup>
                        -->
                        <ice:panelGroup styleClass="col-sm-4">
                            <ace:linkButton value="#{labels.ficha_copiar_proy}" 
                                            action="#{fichaMB.verCopiaProyAction()}"
                                            rendered="#{fichaMB.fieldRendered('copiarProyecto')}"/>
                        </ice:panelGroup>
                    </ice:panelGroup>

                    <ice:panelGroup style="clear: both">
                        <ice:panelGroup styleClass="col-sm-3 colCenter"
                                        rendered="#{fichaMB.fieldRendered('AreaTematica')}">
                            <ice:outputLabel value="#{labels.areaTematicaFicha}"/>
                            <ace:pushButton styleClass="botonEditar #{fichaMB.fieldDisabled('AreaTematica') ? 'iconoDisabledTabla' : 'iconoTabla'} #{fichaMB.areasTematicasHasValues() ? 'valores' : ''}" 
                                            disabled="#{fichaMB.fieldDisabled('AreaTematica')}"
                                            action="#{fichaMB.areaTematicaPopup}"/>
                        </ice:panelGroup>

                        <ice:panelGroup styleClass="col-sm-3 colCenter"
                                        rendered="#{fichaMB.fieldRendered('PermisosLectura')}">
                            <ice:outputLabel value="#{labels.permisosLectura}:"/>
                            <ace:pushButton styleClass="botonEditar #{fichaMB.fieldDisabled('PermisosLectura') ? 'iconoDisabledTabla' : 'iconoTabla'} #{fichaMB.areasRestringidasHasValues() ? 'valores' : ''}" 
                                            disabled="#{fichaMB.fieldDisabled('PermisosLectura')}"
                                            action="#{fichaMB.lecturaPopup}"/>
                        </ice:panelGroup>

                        <ice:panelGroup styleClass="col-sm-3 colCenter"
                                        rendered="#{fichaMB.fieldRendered('Metodologia')}">
                            <ice:outputLabel value="#{labels.metodologia}"/>
                            <ace:pushButton  styleClass="botonEditar #{fichaMB.fieldDisabled('Metodologia') ? 'iconoDisabledTabla' : 'iconoTabla'}"
                                             disabled="#{fichaMB.fieldDisabled('Metodologia')}"
                                             action="#{fichaMB.metodologiaPopup}"/>
                        </ice:panelGroup>

                        <ice:panelGroup styleClass="col-sm-3 colCenter"
                                        rendered="#{fichaMB.fieldRendered('notificaciones')}">
                            <ice:outputLabel value="#{labels.ficha_notificaciones}"/>
                            <ace:pushButton  styleClass="botonEditar #{fichaMB.fieldDisabled('notificaciones') ? 'iconoDisabledTabla' : 'iconoTabla'}"
                                             disabled="#{fichaMB.fieldDisabled('notificaciones')}"
                                             action="#{fichaMB.notificacionPopupAction()}"/>
                        </ice:panelGroup>
                    </ice:panelGroup>

                    <ice:panelGroup rendered="#{fichaMB.fieldRendered('FichaPresupuesto') and fichaMB.fichaTO.proyecto}">
                        <ice:outputLabel value="#{labels.ficha_presupuesto_aprob}:"
                                         styleClass="col-sm-12"/>
                        <ice:selectOneMenu value="#{fichaMB.listaMonedaPreCombo.selected}"
                                           styleClass="col-sm-3"
                                           style="margin-right:10px"
                                           disabled="#{fichaMB.fieldDisabled('FichaPresupuesto')}">
                            <f:selectItems value="#{fichaMB.listaMonedaPreCombo.items}"/>
                        </ice:selectOneMenu>

                        <ace:textEntry value="#{fichaMB.preFicha.preBase}"
                                       styleClass="col-sm-4 textoCorto alinearDerecha"
                                       style="margin-right:10px"
                                       disabled="#{fichaMB.fieldDisabled('FichaPresupuesto')}"
                                       converter="ImporteFormatConverter" />

                        <ice:selectOneMenu value="#{fichaMB.listaFuentesPreCombo.selected}"
                                           styleClass="col-sm-5"
                                           disabled="#{fichaMB.fieldDisabled('FichaPresupuesto')}">
                            <f:selectItems value="#{fichaMB.listaFuentesPreCombo.items}"/>
                        </ice:selectOneMenu>
                    </ice:panelGroup>
                </ice:panelGroup>

                <ice:panelGroup id="fichaDerMapa" styleClass="formulario margen-sup fondo-gris">
                    <ice:outputLabel value="#{labels.ficha_ubicacion}:" />
                    <ace:textEntry value="#{fichaMB.fichaTO.latlngProy.latlngLat}"/>
                    <ace:textEntry value="#{fichaMB.fichaTO.latlngProy.latlngLng}"/>
                    
                    <ace:pushButton styleClass="botonEditar boton #{fichaMB.fieldDisabled('mapaUbicacion') ? 'iconoDisabledTabla' : 'iconoTabla'}"
                                    disabled="#{fichaMB.fieldDisabled('mapaUbicacion')}"
                                    rendered="false"
                                    action="#{fichaMB.mapaUbicacionPopupAction()}"/>
                </ice:panelGroup>

                <ice:panelGroup id="fichaDerOtros" styleClass="formulario margen-sup fondo-gris panelOtrosDatos">
                    <ice:outputLabel value="#{labels.ficha_otros_datos_titulo}"
                                     styleClass="centrarDato subtitulo"/>

                    <ice:panelGroup >
                        <ice:outputLabel value="#{labels.ficha_otros_datos_cat_principal}:"
                                         styleClass="col-sm-5"/>
                        <ice:outputText value="#{fichaMB.fichaTO.otrosDatos.proyOtrCatFk.catProyNombre}"/>
                    </ice:panelGroup>

                    <ice:panelGroup >
                        <ice:outputLabel value="#{labels.ficha_otros_datos_cat_secundarias}:"
                                         rendered="false"
                                         styleClass="col-sm-5"/>
                        <ice:outputText value="#{fichaMB.fichaTO}" rendered="false"/>
                    </ice:panelGroup>

                    <ice:panelGroup styleClass="margen-sup">
                        <ice:outputLabel value="#{labels.ficha_otros_datos_inst_ejec}:"
                                         styleClass="col-sm-5"/>
                        <ice:outputText value="#{fichaMB.fichaTO.otrosDatos.proyOtrInsEjeFk.orgaNombre}"/>
                    </ice:panelGroup>

                    <ice:panelGroup >
                        <ice:outputLabel value="#{labels.ficha_otros_datos_origen}:"
                                         styleClass="col-sm-5"/>
                        <ice:outputText value="#{fichaMB.fichaTO.otrosDatos.proyOtrOrigen}"/>
                    </ice:panelGroup>

                    <ice:panelGroup >
                        <ice:outputLabel value="#{labels.ficha_otros_datos_contratista}:"
                                         styleClass="col-sm-5"/>
                        <ice:outputText value="#{fichaMB.fichaTO.otrosDatos.proyOtrContFk.orgaNombre}"/>
                    </ice:panelGroup>

                    <ice:panelGroup styleClass="margen-sup">
                        <ice:outputLabel value="#{labels.ficha_otros_datos_obs}:"
                                         styleClass="col-sm-5"/>
                        <ice:outputText value="#{fichaMB.fichaTO.otrosDatos.proyOtrObservaciones}"/>
                    </ice:panelGroup>                    

                    <ice:panelGroup styleClass="margen-sup">
                        <ice:outputLabel value="#{labels.ficha_otros_datos_inicio}:"
                                         styleClass="col-sm-5"/>
                        <ice:outputText value="#{fichaMB.fichaTO.otrosDatos.proyOtrEntFk.entNombre}"/>
                    </ice:panelGroup>

                    <ice:panelGroup >
                        <ice:outputLabel value="#{labels.ficha_otros_datos_duracion}:"
                                         styleClass="col-sm-5"/>
                        <ice:outputText value="#{fichaMB.fichaTO.otrosDatos.proyOtrPlazo}"
                                        converter="ImporteFormatConverter"/>
                    </ice:panelGroup>

                    <ice:panelGroup rendered="false">
                        <c:set var="porc" value="%"/>
                        <ice:outputLabel value="#{labels.ficha_otros_datos_avance_prod}:"
                                         styleClass="col-sm-5"/>
                        <ice:panelGroup id="indiceAvanceProd" styleClass="indice3color">
                            <ice:panelGroup style="width:#{fichaMB.indiceAvanceProd[0]}#{porc}"
                                            styleClass="indice3colorBlue">
                                <ice:outputText value="#{fichaMB.indiceAvanceProd[0]}%" rendered="#{fichaMB.indiceAvanceProd[0] gt 10}" />
                            </ice:panelGroup>
                            <ice:panelGroup style="width:#{fichaMB.indiceAvanceProd[1]}#{porc}"
                                            styleClass="indice3colorGreen">
                                <ice:outputText value="#{fichaMB.indiceAvanceProd[1]}%" rendered="#{fichaMB.indiceAvanceProd[1] gt 10}" />
                            </ice:panelGroup>
                            <ice:panelGroup style="width:#{fichaMB.indiceAvanceProd[2]}#{porc}"
                                            styleClass="indice3colorRed">
                                <ice:outputText value="#{fichaMB.indiceAvanceProd[2]}%" rendered="#{fichaMB.indiceAvanceProd[2] gt 10}" />
                            </ice:panelGroup>
                        </ice:panelGroup>
                    </ice:panelGroup>

                    <ice:panelGroup rendered="false">
                        <ice:outputLabel value="#{labels.ficha_otros_datos_avance_tiempo}:"
                                         styleClass="col-sm-5"/>
                        <ice:panelGroup id="indiceAvanceTiempo" styleClass="indice3color">
                            <ice:panelGroup style="width:#{fichaMB.indiceAvanceTiempo[0]}#{porc}"
                                            styleClass="indice3colorBlue">
                                <ice:outputText value="#{fichaMB.indiceAvanceTiempo[0]}%" rendered="#{fichaMB.indiceAvanceTiempo[0] gt 10}" />
                            </ice:panelGroup>
                            <ice:panelGroup style="width:#{fichaMB.indiceAvanceTiempo[1]}#{porc}"
                                            styleClass="indice3colorGreen">
                                <ice:outputText value="#{fichaMB.indiceAvanceTiempo[1]}%" rendered="#{fichaMB.indiceAvanceTiempo[1] gt 10}" />
                            </ice:panelGroup>
                            <ice:panelGroup style="width:#{fichaMB.indiceAvanceTiempo[2]}#{porc}"
                                            styleClass="indice3colorRed">
                                <ice:outputText value="#{fichaMB.indiceAvanceTiempo[2]}%" rendered="#{fichaMB.indiceAvanceTiempo[2] gt 10}" />
                            </ice:panelGroup>
                        </ice:panelGroup>
                    </ice:panelGroup>

                    <ace:pushButton  styleClass="botonEditar boton #{fichaMB.fieldDisabled('editarOtrosDatos') ? 'iconoDisabledTabla' : 'iconoTabla'}"
                                     disabled="#{fichaMB.fieldDisabled('editarOtrosDatos')}"
                                     action="#{fichaMB.otrosDatosPopupAction()}"/>
                </ice:panelGroup>

                <ice:panelGroup id="fichaDerLinks" styleClass="margen-sup linksReportes fondo-gris" 
                                rendered="#{fichaMB.fieldRendered('linksReportes')}">
                    <ice:outputLabel value="#{labels.tituloFichaReportes}"
                                     styleClass="centrarDato subtitulo"/>

                    <ice:panelGroup rendered="#{fichaMB.fichaTO.programa}">
                        <ice:commandLink id="linkReportePrograma"
                                         action="#{inicioMB.irReportePrograma(fichaMB.fichaTO.fichaFk, true)}" 
                                         rendered="#{fichaMB.fichaTO.programa}"
                                         title="#{labels.inicio_reporte_prog}">
                            <ice:outputLabel value="#{labels.ficha_link_prog}" />
                            <ice:graphicImage value="../img/reporte-v.png" />
                        </ice:commandLink>
                    </ice:panelGroup>

                    <ice:panelGroup rendered="#{fichaMB.fichaTO.proyecto}">
                        <ice:commandLink id="linkReporteProyecto"
                                         action="#{inicioMB.irReporteProyecto(fichaMB.fichaTO.fichaFk, true)}" 
                                         rendered="#{fichaMB.fichaTO.proyecto}"
                                         title="#{labels.inicio_reporte_proy}">
                            <ice:outputLabel value="#{labels.ficha_link_proy}" />
                            <ice:graphicImage value="../img/reporte-v.png" />
                        </ice:commandLink>
                    </ice:panelGroup>

                    <ice:panelGroup rendered="#{fichaMB.fichaTO.proyecto}">
                        <ice:commandLink id="linkReporteProyectoTablas"
                                         action="#{inicioMB.irReporteProyectoTablas(fichaMB.fichaTO.fichaFk, true)}" 
                                         rendered="#{fichaMB.fichaTO.proyecto}"
                                         title="#{labels.inicio_reporte_cro_pre}">
                            <ice:outputLabel value="#{labels.ficha_link_cro_pre}" />
                            <ice:graphicImage value="../img/reporte-h.png" />
                        </ice:commandLink>
                    </ice:panelGroup>

                    <ice:panelGroup rendered="#{fichaMB.fichaTO.proyecto}">
                        <ice:commandLink action="#{inicioMB.irReporteCronograma(fichaMB.fichaTO.fichaFk, true)}" 
                                         rendered="#{fichaMB.fichaTO.proyecto}"
                                         title="#{labels.cro_hist_lineabase_link}">
                            <ice:outputLabel value="#{labels.cro_hist_lineabase_link}" />
                            <ice:graphicImage value="../img/reporte-v.png" />
                        </ice:commandLink>
                    </ice:panelGroup>
                </ice:panelGroup>
            </ice:panelGroup>
        </ice:panelGroup>  

        <ice:panelGroup styleClass="panelAcciones">

            <!-- Panel de acciones de la ficha -->
            <ice:panelGroup rendered="#{fichaMB.selectedMostrar == null}" id="panelAcciones" 
                            styleClass="centrado panelBotones margen-sup">

                <ace:messages id="fichaMsg"/>

                <ace:pushButton rendered="#{fichaMB.fieldRendered('GuardarFicha')}"
                                disabled="#{fichaMB.fieldDisabled('GuardarFicha')}"
                                value="#{labels.guardarFicha}"
                                action="#{fichaMB.guardarFichaAction()}"
                                styleClass="boton principal guardar"/>

                <!--
                <ace:pushButton rendered="# {fichaMB.fieldRendered('retrocederEstadoFicha')}" 
                                style="margin-left: 10px;"
                                value="# {fichaMB.labelBtnEstAnterior}" 
                                action="# {fichaMB.retrocederEstadoFichaAction()}" 
                                styleClass="boton principal atras"/>

                <ace:pushButton rendered="# {fichaMB.fieldRendered('AprobarFicha')}" 
                                style="margin-left: 10px;"
                                value="# {fichaMB.labelBtnAprobar}" 
                                action="# {fichaMB.guardarAprobarFichaAction()}" 
                                styleClass="boton principal adelante"/>
                -->

                <h:commandButton id="btnEliminarFicha"
                                 value="#{labels.eliminar}" 
                                 rendered="#{fichaMB.fieldRendered('EliminarFicha')}"
                                 onclick="confirmationEliminar.show()" 
                                 style="margin-left: 10px;"
                                 styleClass="boton principal botonEliminar"
                                 type="button"/>

                <ace:linkButton value="#{labels.volver_inicio}" action="#{fichaMB.cancelar()}"/>
            </ice:panelGroup>
        </ice:panelGroup>

        <!-- Otros elementos de la ficha -->
        <ice:panelGroup id="panelOtrosDatos" styleClass="otrosDatos row margen-sup">
            <div id="fichas">
                <ice:panelGroup id="fichaFragGrupo1" 
                                styleClass="fichaFragGrupo1 col-sm-6 no-padding #{fichaMB.frameMax ? 'fichaFrameMax' : ''}"
                                style="#{fichaMB.selectedMostrar == 3 or fichaMB.selectedMostrar == 4 or fichaMB.selectedMostrar == 1 or fichaMB.selectedMostrar == 5 ? 'width: 100%;' : ''}">
                    <!-- El panel del Gannt ID = 3 -->
                    <ui:include src="./../fragmentos/fichaFragmentosGantt.xhtml" />

                    <!-- El panel del Presupuesto ID = 4 -->
                    <ui:include src="./../fragmentos/fichaFragmentosPresupuesto.xhtml" />

                    <div class="clear"></div>

                    <ice:panelGroup id="fichaFragGrupo3" styleClass="fichaFragGrupo3">
                        <!-- El panel de Productos ID  = 5 -->
                        <ui:include src="./../fragmentos/fichaFragmentosProductos.xhtml" />

                        <!-- EL PANEL DE INTERESADOS ID = 1 -->
                        <ui:include src="./../fragmentos/fichaFragmentosInteresados.xhtml" />
                    </ice:panelGroup>
                </ice:panelGroup>

                <ice:panelGroup id="fichaFragGrupo2" 
                                styleClass="fichaFragGrupo2 col-sm-6"
                                style="#{fichaMB.selectedMostrar == 0 or fichaMB.selectedMostrar == 2 or fichaMB.selectedMostrar == 6 or fichaMB.selectedMostrar == 7 ? 'width: 100%; padding:0;' : ''}">
                    <!-- El panel de Riesgos ID = 2 -->
                    <ui:include src="./../fragmentos/fichaFragmentosRiesgos.xhtml" />

                    <!-- El panel de Documentos ID  = 0 -->
                    <ui:include src="./../fragmentos/fichaFragmentosDocumentos.xhtml" />

                    <!-- EL PANEL DE INTERESADOS ID = 6 -->
                    <ui:include src="./../fragmentos/fichaFragmentosParticipantes.xhtml" />

                    <!-- EL PANEL DE CALIDAD ID = 7 -->
                    <ui:include src="./../fragmentos/fichaFragmentosCalidad.xhtml" />
                </ice:panelGroup>

                <ice:panelGroup id="fichaFragGrupo4" 
                                styleClass="fichaFragGrupo4 col-sm-6 no-padding"
                                style="#{fichaMB.selectedMostrar == 8 ? 'width: 100%; padding:0;' : ''}">
                    <ui:include src="./../fragmentos/fichaFragmentosMultimedia.xhtml" />
                </ice:panelGroup>

            </div>
        </ice:panelGroup>
    </ice:form>
</ui:composition>