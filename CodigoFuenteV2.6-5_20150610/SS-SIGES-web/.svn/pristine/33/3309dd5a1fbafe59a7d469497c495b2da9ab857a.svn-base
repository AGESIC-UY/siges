<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ace="http://www.icefaces.org/icefaces/components"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:icecore="http://www.icefaces.org/icefaces/core"
                xmlns:ice="http://www.icesoft.com/icefaces/component">

    <ice:panelGroup id="panelDocumentos" 
                    styleClass="col-sm-6 cuadro" 
                    style="#{fichaMB.selectedMostrar == 0 ? 'width: 100%; padding-right:25px' : ''}" 
                    rendered="#{(fichaMB.selectedMostrar == null || fichaMB.selectedMostrar == 0) and fichaMB.fieldRendered('panelDocumentos')}">

        <ice:panelGroup id="cabezalDocumentos" styleClass="cabezal" >
            <ice:outputText value="#{labels.documentos}"/>
            <ace:pushButton value=""
                            action="#{fichaMB.miMostrar(0)}" 
                            styleClass="#{fichaMB.selectedMostrar == 0 ? 'botonMinimizar' : 'botonAgregar'} iconoTabla"/>
        </ice:panelGroup>

        <ice:panelGroup rendered="#{not fichaMB.mostrar[0]}" styleClass="cuerpo">
            <ice:panelGroup rendered="#{fichaMB.indiceEstado != null}" styleClass="porcentajeDoc">

                <ice:outputText value="#{labels.resumenMetodologia}: " />
                <ice:outputText value="#{labels.indiceExigidoProyDoc} " rendered="#{fichaMB.fichaTO.programa}" />
                <ice:outputText value="#{fichaMB.indiceEstado}" 
                                converter="IntegerFormatConverter"/>%
                <ice:commandButton style="background-color: #{fichaMB.indiceMetodologiaColor}"
                                   styleClass="botonSemaforo"
                                   disabled="true"/>
            </ice:panelGroup>

            <ace:dataTable id="documentosTable"
                           value="#{fichaMB.listaTipoDocInstResumen}"
                           rendered="#{not empty fichaMB.listaTipoDocInstResumen and fichaMB.fichaTO.proyecto}"
                           styleClass="tablaFicha"
                           var="tipoDoc"
                           paginator="true"
                           paginatorPosition="bottom"
                           rows="10">
                <ace:column id="doc_pendientes" headerText="#{labels.titleResumenDocumentos}">
                    <ice:commandButton style="background-color: #{tipoDoc.docsEstadoColor}"
                                       styleClass="botonSemaforo"
                                       disabled="true"/>
                    <h:outputText id="nombreCell" value="#{tipoDoc.tipodocInstTipoDocFk.tipodocNombre}"/>
                </ace:column>
            </ace:dataTable>

            <ice:panelGroup rendered="#{empty fichaMB.listaTipoDocInstResumen}">
                <ice:outputText value="#{labels.sinDocDesactualizados}" />
            </ice:panelGroup>
        </ice:panelGroup>

        <ice:panelGroup rendered="#{fichaMB.mostrar[0]}" styleClass="cuerpo">
            <ice:panelGroup id="documentosFormData">

                <!-- Formulario de alta -->
                <ice:panelGroup id="documentosForm">
                    <ice:panelCollapsible id="collapsibleDoc" expanded="#{fichaMB.docsFormDataExpanded}">
                        <f:facet name="header">
                            <h:panelGrid columns="1">
                                <h:commandButton value="#{fichaMB.documento.docsPk ne null ? (labels.editarDocumento) : labels.agregarDocumento}" 
                                                 rendered="#{!fichaMB.docsFormDataExpanded and fichaMB.fieldRendered('agregarDocumento')}"
                                                 styleClass="boton principal #{fichaMB.documento.docsPk ne null ? 'editar' : 'agregar'}" />
                            </h:panelGrid>
                        </f:facet>

                        <ice:panelGrid  styleClass="formulario " columns="4">
                            <ice:outputLabel value="#{labels.tipoDocumento}"/>
                            <ace:simpleSelectOneMenu id="comboTipoDocumento"
                                                     value="#{fichaMB.listaTipoDocCombo.selected}">
                                <f:selectItems value="#{fichaMB.listaTipoDocCombo.items}"/>
                            </ace:simpleSelectOneMenu>

                            <ice:outputLabel value="#{labels.nombreDocumento}"/>
                            <ace:textEntry value="#{fichaMB.documento.docsNombre}" />

                            <ice:outputLabel value="#{labels.privadoDocumento}"/>
                            <ace:checkboxButton value="#{fichaMB.documento.docsPrivado}" />

                            <ice:outputLabel value="#{labels.entregableAsociadoDocumento}"/>
                            <ace:simpleSelectOneMenu id="comboentregableDocumento"
                                                     value="#{fichaMB.listaEntregablesCombo.selected}">
                                <f:selectItems value="#{fichaMB.listaEntregablesCombo.items}"/>
                            </ace:simpleSelectOneMenu>

                            <ice:outputLabel value="#{labels.fileDocumento}"/>
                            <ice:panelGroup>
                                <ace:fileEntry id="fileEntryDoc"
                                               label="#{labels.fileDocumento}"
                                               callback=""
                                               relativePath="/files/"
                                               maxFileCount="1" 
                                               maxFileCountMessage="#{labels.fileDocMaxFileCount}" 
                                               fileEntryListener="#{fichaMB.subirArchivoDocAction}" 
                                               maxFileSize="#{configuracionMB.tamanioMaxArchivoDocumento.cnfValor}"
                                               maxFileSizeMessage="#{labels.tamanioMaxArchivoDoc}." 
                                               useOriginalFilename="true" 
                                               useSessionSubdir="true"
                                               style="width: 280px;"/>
                                <h:commandButton id="btnSubmitDoc" type="submit"
                                                 styleClass="iconoTabla subir" />
                                <ace:messages for="fileEntryDoc" />
                            </ice:panelGroup>

                            <ice:outputLabel value="#{labels.doc_pagos}"/>
                            <ace:simpleSelectOneMenu value="#{fichaMB.listaDocPagoCombo.selected}">
                                <f:selectItems value="#{fichaMB.listaDocPagoCombo.items}"/>
                            </ace:simpleSelectOneMenu>
                        </ice:panelGrid>

                        <ice:panelGroup styleClass="panelBotones">
                            <ace:messages for="ficha:btnAgregar"/>
                            <ace:pushButton value="#{fichaMB.documento.docsPk ne null ? labels.editarDocumento : labels.agregarDocumento}" 
                                            styleClass="boton principal" 
                                            id="btnAgregar"
                                            action="#{fichaMB.agregarDocumentoAction()}" />
                            <ace:linkButton   value="#{labels.limpiar}" styleClass="boton secundario" 
                                              action="#{fichaMB.limpiarDocumento()}"/>
                            <ace:linkButton  value="#{labels.cerrar}" styleClass="boton secundario" 
                                             action="#{fichaMB.cerrarFormCollapsable()}"/>
                        </ice:panelGroup>

                    </ice:panelCollapsible>
                </ice:panelGroup>
            </ice:panelGroup>

            <ace:panel id="documentosList" styleClass="resultado recuadro" >
                <ice:panelGroup rendered="#{fichaMB.indiceEstado != null and fichaMB.fichaTO.proyecto}" styleClass="porcentajeDoc">
                    <ice:commandButton style="background-color: #{fichaMB.indiceMetodologiaColor}"
                                       styleClass="botonSemaforo"
                                       disabled="true"/>
                    <ice:outputText value="#{labels.indiceExigidoDoc} " />
                    <ice:outputText value="#{fichaMB.indiceEstado}" 
                                    converter="IntegerFormatConverter"/>%
                </ice:panelGroup>

                <ace:dataTable id="docTable"
                               value="#{fichaMB.listaDocumentosFrame}"
                               var="doc" 
                               binding="#{fichaMB.docsTable}"
                               emptyMessage="#{label.noHayDocumentos}">
                    <ace:row id="docTableRow" 
                             condition="group" 
                             groupBy="#{doc.docsTipo.tipodocInstTipoDocFk.tipdocPk}"
                             pos="before" 
                             styleClass="group-header">
                        <ace:column colspan="4" style="background-color: gainsboro">
                            <ice:outputText value="#{doc.docsTipo.tipodocInstTipoDocFk.tipodocNombre} (#{labels.pesoFicha}#{doc.docsTipo.tipodocInstTipoDocFk.tipodocPeso})" />
                        </ace:column>
                        <ace:column colspan="6" style="background-color: gainsboro">
                            <ice:outputText value="#{doc.docsTipo.tipodocExigidoDesde}" converter="estadoConverter"/>
                        </ace:column>
                    </ace:row>

                    <ace:column id="docTableColTipNo" headerText="#{labels.tipoDocNombre}" 
                                groupBy="#{doc.docsTipo.tipodocInstTipoDocFk.tipdocPk}">
                    </ace:column>

                    <ace:column id="docTableColNom" headerText="#{labels.nombreDocumento}" >
                        <h:outputText value="#{doc.docsNombre != null ? doc.docsNombre : ''}"
                                      rendered="#{!doc.tieneArchivo}"/>
                        <ice:outputResource 
                            rendered="#{doc.tieneArchivo}"
                            resource="#{fichaMB.downloadFile[doc.docsPk]}"
                            label="#{doc.docsNombre != null ? doc.docsNombre : labels.descargar_archivo}"
                            fileName="#{fichaMB.downloadFile[doc.docsPk] != null ? fichaMB.downloadFile[doc.docsPk].docFile.docfileNombre : 'file'}"/>
                    </ace:column>

                    <ace:column id="docTableColFech"  headerText="#{labels.fechaDocumento}" sortAscending="false">
                        <h:outputText value="#{doc.docsFecha != null ? doc.docsFecha : ''}">
                            <f:convertDateTime pattern="dd/MM/yyyy" type="date" />
                        </h:outputText>
                    </ace:column>

                    <ace:column id="docTableColPriv" headerText="#{labels.privadoDocumento}"  >
                        <ace:checkboxButton value="#{doc.docsPrivado}" disabled="true" />
                    </ace:column>

                    <ace:column id="docTableColRequ"  headerText="#{labels.requeridoDocumento}">
                    </ace:column>

                    <ace:column headerText="#{labels.entregableAsociadoDocumento}"  >
                        <ice:outputText value="#{doc.docsEntregable != null ? doc.docsEntregable.entNombre : ''}"/>
                    </ace:column>

                    <ace:column id="docTableColEstad"
                                styleClass="columnaBoton">
                        <ice:commandButton style="background-color: #{doc.estadoColor};"
                                           styleClass="botonSemaforo"
                                           rendered="#{doc.docsTipo.tipodocExigidoDesde.intValue() ne 0}" 
                                           disabled="true"/>
                    </ace:column>

                    <ace:column styleClass="columnaBoton"
                                rendered="#{doc.docsPk != null and doc.docsPk gt 0}">
                        <ace:tooltip id="tooltipVer" for="btnVerDocumentos">
                            <ice:outputText value="#{labels.documentoVer}" />
                        </ace:tooltip>
                        <ace:pushButton id="btnVerDocumentos"
                                        action="#{fichaMB.documentosPopup(doc.docsPk)}" 
                                        styleClass="iconoTabla botonVer"/>
                    </ace:column>

                    <ace:column styleClass="columnaBoton"
                                rendered="#{doc.docsPk != null and doc.docsPk gt 0 and fichaMB.fieldRendered('editarDocumento')}">
                        <ace:tooltip id="tooltipEditar" for="btnEditar">
                            <ice:outputText value="#{labels.editarTooltip}" />
                        </ace:tooltip>
                        <ace:pushButton id="btnEditar" styleClass="botonEditar iconoTabla" 
                                        action="#{fichaMB.editarDocumentoAction(doc.docsPk)}"/>
                    </ace:column>

                    <ace:column styleClass="columnaBoton"
                                rendered="#{doc.docsPk != null and doc.docsPk gt 0 and fichaMB.fieldRendered('eliminarDocumento')}">
                        <h:commandButton id="btnEliminarDoc"
                                         styleClass="botonEliminar iconoTabla"
                                         title="#{labels.eliminarTooltip}:&#13;#{doc.docsNombre}"
                                         onclick="confirmationEliminarDoc#{doc.docsPk}.show();" />
                        <ace:confirmationDialog widgetVar="confirmationEliminarDoc#{doc.docsPk}" 
                                                message="#{labels.eliminar}: &#13;#{doc.docsNombre}"
                                                header="#{labels.hConfirmacion}"
                                                closable="true"
                                                closeOnEscape="true"
                                                severity="info"
                                                modal="false"
                                                position="center">
                            <h:panelGrid columns="2" styleClass="centeredPanelGrid">
                                <h:commandButton value="#{labels.si}"
                                                 styleClass="boton principal botonContinuar"
                                                 onclick="confirmationEliminarDoc#{doc.docsPk}.hide();" 
                                                 actionListener="#{fichaMB.eliminarDocumentoAction(doc.docsPk)}"/>
                                <h:commandButton value="#{labels.no}"
                                                 styleClass="boton principal botonEliminar"
                                                 onclick="confirmationEliminarDoc#{doc.docsPk}.hide();"/>
                            </h:panelGrid>
                        </ace:confirmationDialog>
                    </ace:column>

                </ace:dataTable>
            </ace:panel>
        </ice:panelGroup>
    </ice:panelGroup>
</ui:composition>